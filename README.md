# æ”¹è¿›yolo11-MSBlockç­‰200+å…¨å¥—åˆ›æ–°ç‚¹å¤§å…¨ï¼šç­ç«å™¨æ£€æµ‹ç³»ç»Ÿæºç ï¼†æ•°æ®é›†å…¨å¥—

### 1.å›¾ç‰‡æ•ˆæœå±•ç¤º

![1.png](1.png)

![2.png](2.png)

![3.png](3.png)

##### é¡¹ç›®æ¥æº **[äººå·¥æ™ºèƒ½ä¿ƒè¿›ä¼š 2024.10.28](https://kdocs.cn/l/cszuIiCKVNis)**

æ³¨æ„ï¼šç”±äºé¡¹ç›®ä¸€ç›´åœ¨æ›´æ–°è¿­ä»£ï¼Œä¸Šé¢â€œ1.å›¾ç‰‡æ•ˆæœå±•ç¤ºâ€å’Œâ€œ2.è§†é¢‘æ•ˆæœå±•ç¤ºâ€å±•ç¤ºçš„ç³»ç»Ÿå›¾ç‰‡æˆ–è€…è§†é¢‘å¯èƒ½ä¸ºè€ç‰ˆæœ¬ï¼Œæ–°ç‰ˆæœ¬åœ¨è€ç‰ˆæœ¬çš„åŸºç¡€ä¸Šå‡çº§å¦‚ä¸‹ï¼šï¼ˆå®é™…æ•ˆæœä»¥å‡çº§çš„æ–°ç‰ˆæœ¬ä¸ºå‡†ï¼‰

  ï¼ˆ1ï¼‰é€‚é…äº†YOLOV11çš„â€œç›®æ ‡æ£€æµ‹â€æ¨¡å‹å’Œâ€œå®ä¾‹åˆ†å‰²â€æ¨¡å‹ï¼Œé€šè¿‡åŠ è½½ç›¸åº”çš„æƒé‡ï¼ˆ.ptï¼‰æ–‡ä»¶å³å¯è‡ªé€‚åº”åŠ è½½æ¨¡å‹ã€‚

  ï¼ˆ2ï¼‰æ”¯æŒâ€œå›¾ç‰‡è¯†åˆ«â€ã€â€œè§†é¢‘è¯†åˆ«â€ã€â€œæ‘„åƒå¤´å®æ—¶è¯†åˆ«â€ä¸‰ç§è¯†åˆ«æ¨¡å¼ã€‚

  ï¼ˆ3ï¼‰æ”¯æŒâ€œå›¾ç‰‡è¯†åˆ«â€ã€â€œè§†é¢‘è¯†åˆ«â€ã€â€œæ‘„åƒå¤´å®æ—¶è¯†åˆ«â€ä¸‰ç§è¯†åˆ«ç»“æœä¿å­˜å¯¼å‡ºï¼Œè§£å†³æ‰‹åŠ¨å¯¼å‡ºï¼ˆå®¹æ˜“å¡é¡¿å‡ºç°çˆ†å†…å­˜ï¼‰å­˜åœ¨çš„é—®é¢˜ï¼Œè¯†åˆ«å®Œè‡ªåŠ¨ä¿å­˜ç»“æœå¹¶å¯¼å‡ºåˆ°tempDirä¸­ã€‚

  ï¼ˆ4ï¼‰æ”¯æŒWebå‰ç«¯ç³»ç»Ÿä¸­çš„æ ‡é¢˜ã€èƒŒæ™¯å›¾ç­‰è‡ªå®šä¹‰ä¿®æ”¹ã€‚

  å¦å¤–æœ¬é¡¹ç›®æä¾›è®­ç»ƒçš„æ•°æ®é›†å’Œè®­ç»ƒæ•™ç¨‹,æš‚ä¸æä¾›æƒé‡æ–‡ä»¶ï¼ˆbest.ptï¼‰,éœ€è¦æ‚¨æŒ‰ç…§æ•™ç¨‹è¿›è¡Œè®­ç»ƒåå®ç°å›¾ç‰‡æ¼”ç¤ºå’ŒWebå‰ç«¯ç•Œé¢æ¼”ç¤ºçš„æ•ˆæœã€‚

### 2.è§†é¢‘æ•ˆæœå±•ç¤º

[2.1 è§†é¢‘æ•ˆæœå±•ç¤º](https://www.bilibili.com/video/BV1ddSWY4EKV/)

### 3.èƒŒæ™¯

ç ”ç©¶èƒŒæ™¯ä¸æ„ä¹‰

éšç€åŸå¸‚åŒ–è¿›ç¨‹çš„åŠ å¿«å’Œå·¥ä¸šåŒ–æ°´å¹³çš„æå‡ï¼Œç«ç¾äº‹æ•…çš„å‘ç”Ÿé¢‘ç‡é€å¹´ä¸Šå‡ï¼Œç»™äººæ°‘ç”Ÿå‘½è´¢äº§å®‰å…¨å¸¦æ¥äº†ä¸¥é‡å¨èƒã€‚æœ‰æ•ˆçš„ç«ç¾é¢„é˜²å’Œç­ç«æªæ–½æˆä¸ºäº†ç¤¾ä¼šå„ç•Œå…³æ³¨çš„ç„¦ç‚¹ã€‚ç­ç«å™¨ä½œä¸ºä¸€ç§é‡è¦çš„æ¶ˆé˜²è®¾å¤‡ï¼Œå…¶åœ¨ç«ç¾åˆæœŸçš„å¿«é€Ÿååº”èƒ½åŠ›è‡³å…³é‡è¦ã€‚ç„¶è€Œï¼Œä¼ ç»Ÿçš„ç­ç«å™¨æ£€æŸ¥å’Œç»´æŠ¤æ–¹å¼å¾€å¾€ä¾èµ–äººå·¥å·¡æ£€ï¼Œæ•ˆç‡ä½ä¸‹ä¸”å®¹æ˜“å‡ºç°é—æ¼ã€‚å› æ­¤ï¼ŒåŸºäºè®¡ç®—æœºè§†è§‰æŠ€æœ¯çš„è‡ªåŠ¨åŒ–ç­ç«å™¨æ£€æµ‹ç³»ç»Ÿåº”è¿è€Œç”Ÿï¼Œæˆä¸ºæå‡æ¶ˆé˜²å®‰å…¨ç®¡ç†æ°´å¹³çš„é‡è¦æ‰‹æ®µã€‚

æœ¬ç ”ç©¶æ—¨åœ¨åŸºäºæ”¹è¿›çš„YOLOv11æ¨¡å‹ï¼Œæ„å»ºä¸€ä¸ªé«˜æ•ˆçš„ç­ç«å™¨æ£€æµ‹ç³»ç»Ÿã€‚YOLOï¼ˆYou Only Look Onceï¼‰ç³»åˆ—æ¨¡å‹ä»¥å…¶å¿«é€Ÿçš„æ£€æµ‹é€Ÿåº¦å’Œè¾ƒé«˜çš„å‡†ç¡®ç‡åœ¨ç›®æ ‡æ£€æµ‹é¢†åŸŸå–å¾—äº†æ˜¾è‘—çš„æˆæœã€‚é€šè¿‡å¯¹YOLOv11çš„æ”¹è¿›ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿåœ¨å¤æ‚ç¯å¢ƒä¸­å®ç°å¯¹ä¸åŒç±»å‹ç­ç«å™¨çš„å‡†ç¡®è¯†åˆ«ä¸å®šä½ã€‚å…·ä½“è€Œè¨€ï¼Œæœ¬é¡¹ç›®å°†ä½¿ç”¨åŒ…å«242å¼ å›¾åƒçš„æ•°æ®é›†ï¼Œæ¶µç›–ä¸‰ç±»ç­ç«å™¨ï¼šABCå¹²ç²‰ç­ç«å™¨ã€CO2ç­ç«å™¨å’ŒYAMATO ABCå¹²ç²‰ç­ç«å™¨ã€‚è¿™äº›æ•°æ®çš„å¤šæ ·æ€§å’Œä¸°å¯Œæ€§ä¸ºæ¨¡å‹çš„è®­ç»ƒæä¾›äº†è‰¯å¥½çš„åŸºç¡€ã€‚

é€šè¿‡å¯¹ç­ç«å™¨çš„è‡ªåŠ¨æ£€æµ‹ä¸è¯†åˆ«ï¼Œä¸ä»…å¯ä»¥æé«˜ç­ç«å™¨çš„ç®¡ç†æ•ˆç‡ï¼Œè¿˜èƒ½åœ¨ç«ç¾å‘ç”Ÿæ—¶æä¾›åŠæ—¶çš„å“åº”ä¿¡æ¯ï¼Œå¸®åŠ©äººä»¬è¿…é€Ÿæ‰¾åˆ°åˆé€‚çš„ç­ç«å™¨è¿›è¡Œè‡ªæ•‘ã€‚åŒæ—¶ï¼Œè¯¥ç³»ç»Ÿçš„åº”ç”¨è¿˜å¯ä»¥ä¸ºæ¶ˆé˜²å®‰å…¨æ•™è‚²æä¾›æ”¯æŒï¼Œå¢å¼ºå…¬ä¼—çš„æ¶ˆé˜²å®‰å…¨æ„è¯†ã€‚ç»¼ä¸Šæ‰€è¿°ï¼ŒåŸºäºæ”¹è¿›YOLOv11çš„ç­ç«å™¨æ£€æµ‹ç³»ç»Ÿçš„ç ”ç©¶ï¼Œä¸ä»…å…·æœ‰é‡è¦çš„ç†è®ºæ„ä¹‰ï¼Œè¿˜æœ‰åŠ©äºæå‡å®é™…æ¶ˆé˜²å®‰å…¨ç®¡ç†æ°´å¹³ï¼Œä¸ºç¤¾ä¼šçš„å®‰å…¨ç¨³å®šåšå‡ºè´¡çŒ®ã€‚

### 4.æ•°æ®é›†ä¿¡æ¯å±•ç¤º

##### 4.1 æœ¬é¡¹ç›®æ•°æ®é›†è¯¦ç»†æ•°æ®ï¼ˆç±»åˆ«æ•°ï¼†ç±»åˆ«åï¼‰

nc: 3
names: ['fire protection - ABC POWDER fire Extinguisher', 'fire protection - CO2 fire Extinguisher', 'fire protection - YAMATO ABC POWDER  fire Extinguisher']



è¯¥é¡¹ç›®ä¸ºã€ç›®æ ‡æ£€æµ‹ã€‘æ•°æ®é›†ï¼Œè¯·åœ¨ã€è®­ç»ƒæ•™ç¨‹å’ŒWebç«¯åŠ è½½æ¨¡å‹æ•™ç¨‹ï¼ˆç¬¬ä¸‰æ­¥ï¼‰ã€‘è¿™ä¸€æ­¥çš„æ—¶å€™æŒ‰ç…§ã€ç›®æ ‡æ£€æµ‹ã€‘éƒ¨åˆ†çš„æ•™ç¨‹æ¥è®­ç»ƒ

##### 4.2 æœ¬é¡¹ç›®æ•°æ®é›†ä¿¡æ¯ä»‹ç»

æœ¬é¡¹ç›®æ•°æ®é›†ä¿¡æ¯ä»‹ç»

æœ¬é¡¹ç›®æ‰€ä½¿ç”¨çš„æ•°æ®é›†åä¸ºâ€œfire extinguisherâ€ï¼Œæ—¨åœ¨ä¸ºæ”¹è¿›YOLOv11çš„ç­ç«å™¨æ£€æµ‹ç³»ç»Ÿæä¾›å¼ºæœ‰åŠ›çš„æ”¯æŒã€‚è¯¥æ•°æ®é›†ä¸“æ³¨äºç­ç«å™¨çš„æ£€æµ‹ä¸åˆ†ç±»ï¼ŒåŒ…å«äº†ä¸‰ç§ä¸»è¦ç±»åˆ«ï¼Œåˆ†åˆ«æ˜¯â€œfire protection - ABC POWDER fire Extinguisherâ€ã€â€œfire protection - CO2 fire Extinguisherâ€ä»¥åŠâ€œfire protection - YAMATO ABC POWDER fire Extinguisherâ€ã€‚è¿™äº›ç±»åˆ«çš„é€‰æ‹©ä¸ä»…è€ƒè™‘åˆ°äº†ç­ç«å™¨çš„å¹¿æ³›åº”ç”¨æ€§ï¼Œè¿˜æ¶µç›–äº†ä¸åŒç±»å‹ç­ç«å™¨çš„ç‰¹æ€§ä¸åŠŸèƒ½ï¼Œä¸ºç³»ç»Ÿçš„è®­ç»ƒæä¾›äº†å¤šæ ·åŒ–çš„æ ·æœ¬ã€‚

æ•°æ®é›†ä¸­æ¯ä¸€ç±»ç­ç«å™¨çš„å›¾åƒå‡ç»è¿‡ç²¾å¿ƒæŒ‘é€‰ï¼Œç¡®ä¿åœ¨ä¸åŒç¯å¢ƒã€è§’åº¦å’Œå…‰ç…§æ¡ä»¶ä¸‹å‡èƒ½æœ‰æ•ˆåœ°åæ˜ å‡ºç­ç«å™¨çš„å¤–è§‚ç‰¹å¾ã€‚è¿™ç§å¤šæ ·æ€§ä½¿å¾—æ¨¡å‹åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­èƒ½å¤Ÿå­¦ä¹ åˆ°æ›´ä¸ºä¸°å¯Œçš„ç‰¹å¾ï¼Œä»è€Œæé«˜å…¶åœ¨å®é™…åº”ç”¨ä¸­çš„è¯†åˆ«å‡†ç¡®ç‡ã€‚æ­¤å¤–ï¼Œæ•°æ®é›†ä¸­çš„å›¾åƒæ ‡æ³¨ä¿¡æ¯è¯¦ç»†ï¼Œç¡®ä¿æ¯ä¸ªæ ·æœ¬çš„ç±»åˆ«ä¿¡æ¯æ¸…æ™°æ˜äº†ï¼Œä¾¿äºæ¨¡å‹è¿›è¡Œæœ‰æ•ˆçš„å­¦ä¹ ä¸åˆ†ç±»ã€‚

é€šè¿‡å¯¹â€œfire extinguisherâ€æ•°æ®é›†çš„æ·±å…¥åˆ†æä¸åº”ç”¨ï¼Œæœ¬é¡¹ç›®æ—¨åœ¨æå‡YOLOv11åœ¨ç­ç«å™¨æ£€æµ‹ä»»åŠ¡ä¸­çš„æ€§èƒ½ï¼Œè¿›è€Œä¸ºç«ç¾å®‰å…¨ç®¡ç†æä¾›æŠ€æœ¯æ”¯æŒã€‚è¯¥æ•°æ®é›†ä¸ä»…ä¸ºæ¨¡å‹çš„è®­ç»ƒæä¾›äº†åšå®çš„åŸºç¡€ï¼Œä¹Ÿä¸ºåç»­çš„æ¨¡å‹ä¼˜åŒ–ä¸åº”ç”¨å¥ å®šäº†è‰¯å¥½çš„æ•°æ®åŸºç¡€ã€‚éšç€é¡¹ç›®çš„æ·±å…¥ï¼Œé¢„è®¡å°†è¿›ä¸€æ­¥æ‰©å±•æ•°æ®é›†çš„è§„æ¨¡ä¸å¤šæ ·æ€§ï¼Œä»¥åº”å¯¹æ›´å¤æ‚çš„æ£€æµ‹åœºæ™¯å’Œéœ€æ±‚ï¼Œæ¨åŠ¨ç­ç«å™¨æ£€æµ‹æŠ€æœ¯çš„ä¸æ–­è¿›æ­¥ã€‚

![4.png](4.png)

![5.png](5.png)

![6.png](6.png)

![7.png](7.png)

![8.png](8.png)

### 5.å…¨å¥—é¡¹ç›®ç¯å¢ƒéƒ¨ç½²è§†é¢‘æ•™ç¨‹ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰

[5.1 æ‰€éœ€è½¯ä»¶PyCharmå’ŒAnacondaå®‰è£…æ•™ç¨‹ï¼ˆç¬¬ä¸€æ­¥ï¼‰](https://www.bilibili.com/video/BV1BoC1YCEKi/?spm_id_from=333.999.0.0&vd_source=bc9aec86d164b67a7004b996143742dc)




[5.2 å®‰è£…Pythonè™šæ‹Ÿç¯å¢ƒåˆ›å»ºå’Œä¾èµ–åº“å®‰è£…è§†é¢‘æ•™ç¨‹ï¼ˆç¬¬äºŒæ­¥ï¼‰](https://www.bilibili.com/video/BV1ZoC1YCEBw?spm_id_from=333.788.videopod.sections&vd_source=bc9aec86d164b67a7004b996143742dc)

### 6.æ”¹è¿›YOLOv11è®­ç»ƒæ•™ç¨‹å’ŒWeb_UIå‰ç«¯åŠ è½½æ¨¡å‹æ•™ç¨‹ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰

[6.1 æ”¹è¿›YOLOv11è®­ç»ƒæ•™ç¨‹å’ŒWeb_UIå‰ç«¯åŠ è½½æ¨¡å‹æ•™ç¨‹ï¼ˆç¬¬ä¸‰æ­¥ï¼‰](https://www.bilibili.com/video/BV1BoC1YCEhR?spm_id_from=333.788.videopod.sections&vd_source=bc9aec86d164b67a7004b996143742dc)


æŒ‰ç…§ä¸Šé¢çš„è®­ç»ƒè§†é¢‘æ•™ç¨‹é“¾æ¥åŠ è½½é¡¹ç›®æä¾›çš„æ•°æ®é›†ï¼Œè¿è¡Œtrain.pyå³å¯å¼€å§‹è®­ç»ƒ
ï»¿


     Epoch   gpu_mem       box       obj       cls    labels  img_size
     1/200     20.8G   0.01576   0.01955  0.007536        22      1280: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 849/849 [14:42<00:00,  1.04s/it]
               Class     Images     Labels          P          R     mAP@.5 mAP@.5:.95: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 213/213 [01:14<00:00,  2.87it/s]
                 all       3395      17314      0.994      0.957      0.0957      0.0843

     Epoch   gpu_mem       box       obj       cls    labels  img_size
     2/200     20.8G   0.01578   0.01923  0.007006        22      1280: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 849/849 [14:44<00:00,  1.04s/it]
               Class     Images     Labels          P          R     mAP@.5 mAP@.5:.95: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 213/213 [01:12<00:00,  2.95it/s]
                 all       3395      17314      0.996      0.956      0.0957      0.0845

     Epoch   gpu_mem       box       obj       cls    labels  img_size
     3/200     20.8G   0.01561    0.0191  0.006895        27      1280: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 849/849 [10:56<00:00,  1.29it/s]
               Class     Images     Labels          P          R     mAP@.5 mAP@.5:.95: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   | 187/213 [00:52<00:00,  4.04it/s]
                 all       3395      17314      0.996      0.957      0.0957      0.0845




###### [é¡¹ç›®æ•°æ®é›†ä¸‹è½½é“¾æ¥](https://kdocs.cn/l/cszuIiCKVNis)

### 7.åŸå§‹YOLOv11ç®—æ³•è®²è§£

YOLOv11æ˜¯Ultralyticsæ¨å‡ºçš„YOLOç³»åˆ—æœ€æ–°ç‰ˆæœ¬ï¼Œä¸“ä¸ºå®ç°å°–ç«¯çš„ç‰©ä½“æ£€æµ‹è€Œè®¾è®¡ã€‚å…¶æ¶æ„å’Œè®­ç»ƒæ–¹æ³•ä¸Šè¿›è¡Œäº†é‡å¤§æ”¹è¿›ï¼Œä½¿ä¹‹ä¸ä»…å…·å¤‡å“è¶Šçš„å‡†ç¡®æ€§å’Œå¤„ç†é€Ÿåº¦ï¼Œè¿˜åœ¨è®¡ç®—æ•ˆç‡ä¸Šå®ç°äº†ä¸€åœºé©å‘½ã€‚å¾—ç›Šäºå…¶æ”¹è¿›çš„ä¸»å¹²å’Œé¢ˆéƒ¨æ¶æ„ï¼ŒYOLOv11åœ¨ç‰¹å¾æå–å’Œå¤„ç†å¤æ‚ä»»åŠ¡æ—¶è¡¨ç°æ›´åŠ å‡ºè‰²ã€‚åœ¨2024å¹´9æœˆ27æ—¥ï¼ŒUltralyticsé€šè¿‡é•¿è¾¾ä¹å°æ—¶çš„åœ¨çº¿ç›´æ’­å‘å¸ƒè¿™ä¸€æ–°ä½œï¼Œå±•ç¤ºäº†å…¶åœ¨è®¡ç®—æœºè§†è§‰é¢†åŸŸçš„é©æ–°ã€‚

YOLOv11é€šè¿‡ç²¾ç»†çš„æ¶æ„è®¾è®¡å’Œä¼˜åŒ–è®­ç»ƒæµç¨‹ï¼Œåœ¨ä¿æŒé«˜ç²¾åº¦çš„åŒæ—¶ï¼Œç¼©å‡äº†å‚æ•°é‡ï¼Œä¸YOLOv8mç›¸æ¯”å‡å°‘äº†22%çš„å‚æ•°ï¼Œä½¿å…¶åœ¨COCOæ•°æ®é›†ä¸Šçš„å¹³å‡å‡†ç¡®åº¦ï¼ˆmAPï¼‰æœ‰æ‰€æå‡ã€‚è¿™ç§æ•ˆç‡çš„æé«˜ä½¿YOLOv11éå¸¸é€‚åˆéƒ¨ç½²åœ¨å„ç§ç¡¬ä»¶ç¯å¢ƒä¸­ï¼ŒåŒ…æ‹¬è¾¹ç¼˜è®¾å¤‡ã€äº‘è®¡ç®—å¹³å°ä»¥åŠæ”¯æŒNVIDIA GPUçš„ç³»ç»Ÿï¼Œç¡®ä¿åœ¨çµæ´»æ€§ä¸Šçš„ä¼˜åŠ¿ã€‚

è¯¥æ¨¡å‹æ”¯æŒå¹¿æ³›çš„ä»»åŠ¡ï¼Œä»å¯¹è±¡æ£€æµ‹ã€å®ä¾‹åˆ†å‰²åˆ°å›¾åƒåˆ†ç±»ã€å§¿æ€ä¼°è®¡å’Œå®šå‘å¯¹è±¡æ£€æµ‹ï¼ˆOBBï¼‰ï¼Œå‡ ä¹è¦†ç›–äº†è®¡ç®—æœºè§†è§‰çš„æ‰€æœ‰ä¸»è¦æŒ‘æˆ˜ã€‚å…¶åˆ›æ–°çš„C3k2å’ŒC2PSAæ¨¡å—æå‡äº†ç½‘ç»œæ·±åº¦å’Œæ³¨æ„åŠ›æœºåˆ¶çš„åº”ç”¨ï¼Œæé«˜äº†ç‰¹å¾æå–çš„æ•ˆç‡å’Œæ•ˆæœã€‚åŒæ—¶ï¼ŒYOLOv11çš„æ”¹è¿›ç½‘ç»œç»“æ„ä¹Ÿä½¿ä¹‹åœ¨å¤æ‚è§†è§‰ä»»åŠ¡ä¸Šå¾—ä»¥ä»å®¹åº”å¯¹ï¼Œæˆä¸ºå„ç±»è®¡ç®—æœºè§†è§‰ä»»åŠ¡çš„å¤šåŠŸèƒ½é€‰æ‹©ã€‚è¿™äº›ç‰¹æ€§ä»¤YOLOv11åœ¨å®æ–½å®æ—¶ç‰©ä½“æ£€æµ‹çš„å„ä¸ªé¢†åŸŸä¸­è¡¨ç°å‡ºä¼—ã€‚
* * *

2024å¹´9æœˆ27æ—¥ï¼ŒUltralyticsåœ¨çº¿ç›´æ’­é•¿è¾¾ä¹å°æ—¶ï¼Œä¸ºYOLO11å¬å¼€â€œå‘å¸ƒä¼šâ€

YOLO11 æ˜¯ Ultralytics YOLO ç³»åˆ—å®æ—¶ç‰©ä½“æ£€æµ‹å™¨çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå®ƒä»¥å°–ç«¯çš„å‡†ç¡®æ€§ã€é€Ÿåº¦å’Œæ•ˆç‡é‡æ–°å®šä¹‰äº†å¯èƒ½æ€§ã€‚åœ¨ä¹‹å‰ YOLO
ç‰ˆæœ¬çš„æ˜¾è‘—è¿›æ­¥çš„åŸºç¡€ä¸Šï¼ŒYOLO11 åœ¨æ¶æ„å’Œè®­ç»ƒæ–¹æ³•æ–¹é¢è¿›è¡Œäº†é‡å¤§æ”¹è¿›ï¼Œä½¿å…¶æˆä¸ºå„ç§è®¡ç®—æœºè§†è§‰ä»»åŠ¡çš„å¤šåŠŸèƒ½é€‰æ‹©ã€‚

![](https://i-blog.csdnimg.cn/direct/a4e1a178833746249720ccee1c82a58b.png)

##### YOLO11ä¸»è¦ç‰¹ç‚¹ï¼š

  * å¢å¼ºçš„ç‰¹å¾æå–ï¼šYOLO11 é‡‡ç”¨äº†æ”¹è¿›çš„ä¸»å¹²å’Œé¢ˆéƒ¨æ¶æ„ï¼Œå¢å¼ºäº†ç‰¹å¾æå–èƒ½åŠ›ï¼Œå¯å®ç°æ›´ç²¾ç¡®çš„å¯¹è±¡æ£€æµ‹å’Œå¤æ‚ä»»åŠ¡æ€§èƒ½ã€‚
  * é’ˆå¯¹æ•ˆç‡å’Œé€Ÿåº¦è¿›è¡Œäº†ä¼˜åŒ–ï¼šYOLO11 å¼•å…¥äº†å®Œå–„çš„æ¶æ„è®¾è®¡å’Œä¼˜åŒ–çš„è®­ç»ƒæµç¨‹ï¼Œå¯æä¾›æ›´å¿«çš„å¤„ç†é€Ÿåº¦ï¼Œå¹¶åœ¨å‡†ç¡®åº¦å’Œæ€§èƒ½ä¹‹é—´ä¿æŒæœ€ä½³å¹³è¡¡ã€‚
  * æ›´å°‘çš„å‚æ•°ï¼Œæ›´é«˜çš„å‡†ç¡®åº¦ï¼šå€ŸåŠ©æ¨¡å‹è®¾è®¡çš„è¿›æ­¥ï¼ŒYOLO11m åœ¨ COCO æ•°æ®é›†ä¸Šå®ç°äº†æ›´é«˜çš„å¹³å‡å‡†ç¡®åº¦ (mAP)ï¼ŒåŒæ—¶ä½¿ç”¨çš„å‚æ•°æ¯” YOLOv8m å°‘ 22%ï¼Œä»è€Œæé«˜äº†è®¡ç®—æ•ˆç‡ï¼ŒåŒæ—¶åˆä¸å½±å“å‡†ç¡®åº¦ã€‚
  * è·¨ç¯å¢ƒçš„é€‚åº”æ€§ï¼šYOLO11 å¯ä»¥æ— ç¼éƒ¨ç½²åœ¨å„ç§ç¯å¢ƒä¸­ï¼ŒåŒ…æ‹¬è¾¹ç¼˜è®¾å¤‡ã€äº‘å¹³å°å’Œæ”¯æŒ NVIDIA GPU çš„ç³»ç»Ÿï¼Œä»è€Œç¡®ä¿æœ€å¤§çš„çµæ´»æ€§ã€‚
  * æ”¯æŒçš„ä»»åŠ¡èŒƒå›´å¹¿æ³›ï¼šæ— è®ºæ˜¯å¯¹è±¡æ£€æµ‹ã€å®ä¾‹åˆ†å‰²ã€å›¾åƒåˆ†ç±»ã€å§¿åŠ¿ä¼°è®¡è¿˜æ˜¯å®šå‘å¯¹è±¡æ£€æµ‹ (OBB)ï¼ŒYOLO11 éƒ½æ—¨åœ¨æ»¡è¶³å„ç§è®¡ç®—æœºè§†è§‰æŒ‘æˆ˜ã€‚

##### æ”¯æŒçš„ä»»åŠ¡å’Œæ¨¡å¼

YOLO11 ä»¥ YOLOv8 ä¸­å¼•å…¥çš„å¤šåŠŸèƒ½æ¨¡å‹ç³»åˆ—ä¸ºåŸºç¡€ï¼Œä¸ºå„ç§è®¡ç®—æœºè§†è§‰ä»»åŠ¡æä¾›å¢å¼ºçš„æ”¯æŒï¼š

Model| Filenames| Task| Inference| Validation| Training| Export  
---|---|---|---|---|---|---  
YOLO11| yolol11n.pt, yolol11s.pt, yolol11m.pt, yolol11x.pt| Detection| âœ…| âœ…|
âœ…| âœ…  
YOLO11-seg| yolol11n-seg.pt, yolol11s-seg.pt, yolol11m-seg.pt,
yolol11x-seg.pt| Instance Segmentation| âœ…| âœ…| âœ…| âœ…  
YOLO11-pose| yolol11n-pose.pt, yolol11s-pose.pt, yolol11m-pose.pt,
yolol11x-pose.pt| Pose/Keypoints| âœ…| âœ…| âœ…| âœ…  
YOLO11-obb| yolol11n-obb.pt, yolol11s-obb.pt, yolol11m-obb.pt,
yolol11x-obb.pt| Oriented Detection| âœ…| âœ…| âœ…| âœ…  
YOLO11-cls| yolol11n-cls.pt, yolol11s-cls.pt, yolol11m-cls.pt,
yolol11x-cls.pt| Classification| âœ…| âœ…| âœ…| âœ…  
  
##### ç®€å•çš„ YOLO11 è®­ç»ƒå’Œæ¨ç†ç¤ºä¾‹

ä»¥ä¸‹ç¤ºä¾‹é€‚ç”¨äºç”¨äºå¯¹è±¡æ£€æµ‹çš„ YOLO11 Detect æ¨¡å‹ã€‚

    
    
    from ultralytics import YOLO
    
    # Load a model
    model = YOLO("yolo11n.pt")
    
    # Train the model
    train_results = model.train(
        data="coco8.yaml",  # path to dataset YAML
        epochs=100,  # number of training epochs
        imgsz=640,  # training image size
        device="cpu",  # device to run on, i.e. device=0 or device=0,1,2,3 or device=cpu
    )
    
    # Evaluate model performance on the validation set
    metrics = model.val()
    
    # Perform object detection on an image
    results = model("path/to/image.jpg")
    results[0].show()
    
    # Export the model to ONNX format
    path = model.export(format="onnx")  # return path to exported model

##### æ”¯æŒéƒ¨ç½²äºè¾¹ç¼˜è®¾å¤‡

YOLO11 ä¸“ä¸ºé€‚åº”å„ç§ç¯å¢ƒè€Œè®¾è®¡ï¼ŒåŒ…æ‹¬è¾¹ç¼˜è®¾å¤‡ã€‚å…¶ä¼˜åŒ–çš„æ¶æ„å’Œé«˜æ•ˆçš„å¤„ç†èƒ½åŠ›ä½¿å…¶é€‚åˆéƒ¨ç½²åœ¨è¾¹ç¼˜è®¾å¤‡ã€äº‘å¹³å°å’Œæ”¯æŒ NVIDIA GPU
çš„ç³»ç»Ÿä¸Šã€‚è¿™ç§çµæ´»æ€§ç¡®ä¿ YOLO11 å¯ç”¨äºå„ç§åº”ç”¨ï¼Œä»ç§»åŠ¨è®¾å¤‡ä¸Šçš„å®æ—¶æ£€æµ‹åˆ°äº‘ç¯å¢ƒä¸­çš„å¤æ‚åˆ†å‰²ä»»åŠ¡ã€‚æœ‰å…³éƒ¨ç½²é€‰é¡¹çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…å¯¼å‡ºæ–‡æ¡£ã€‚

##### YOLOv11 yamlæ–‡ä»¶

    
    
    # Ultralytics YOLO ğŸš€, AGPL-3.0 license
    # YOLO11 object detection model with P3-P5 outputs. For Usage examples see https://docs.ultralytics.com/tasks/detect
    
    # Parameters
    nc: 80 # number of classes
    scales: # model compound scaling constants, i.e. 'model=yolo11n.yaml' will call yolo11.yaml with scale 'n'
      # [depth, width, max_channels]
      n: [0.50, 0.25, 1024] # summary: 319 layers, 2624080 parameters, 2624064 gradients, 6.6 GFLOPs
      s: [0.50, 0.50, 1024] # summary: 319 layers, 9458752 parameters, 9458736 gradients, 21.7 GFLOPs
      m: [0.50, 1.00, 512] # summary: 409 layers, 20114688 parameters, 20114672 gradients, 68.5 GFLOPs
      l: [1.00, 1.00, 512] # summary: 631 layers, 25372160 parameters, 25372144 gradients, 87.6 GFLOPs
      x: [1.00, 1.50, 512] # summary: 631 layers, 56966176 parameters, 56966160 gradients, 196.0 GFLOPs
    
    # YOLO11n backbone
    backbone:
      # [from, repeats, module, args]
      - [-1, 1, Conv, [64, 3, 2]] # 0-P1/2
      - [-1, 1, Conv, [128, 3, 2]] # 1-P2/4
      - [-1, 2, C3k2, [256, False, 0.25]]
      - [-1, 1, Conv, [256, 3, 2]] # 3-P3/8
      - [-1, 2, C3k2, [512, False, 0.25]]
      - [-1, 1, Conv, [512, 3, 2]] # 5-P4/16
      - [-1, 2, C3k2, [512, True]]
      - [-1, 1, Conv, [1024, 3, 2]] # 7-P5/32
      - [-1, 2, C3k2, [1024, True]]
      - [-1, 1, SPPF, [1024, 5]] # 9
      - [-1, 2, C2PSA, [1024]] # 10
    
    # YOLO11n head
    head:
      - [-1, 1, nn.Upsample, [None, 2, "nearest"]]
      - [[-1, 6], 1, Concat, [1]] # cat backbone P4
      - [-1, 2, C3k2, [512, False]] # 13
    
      - [-1, 1, nn.Upsample, [None, 2, "nearest"]]
      - [[-1, 4], 1, Concat, [1]] # cat backbone P3
      - [-1, 2, C3k2, [256, False]] # 16 (P3/8-small)
    
      - [-1, 1, Conv, [256, 3, 2]]
      - [[-1, 13], 1, Concat, [1]] # cat head P4
      - [-1, 2, C3k2, [512, False]] # 19 (P4/16-medium)
    
      - [-1, 1, Conv, [512, 3, 2]]
      - [[-1, 10], 1, Concat, [1]] # cat head P5
      - [-1, 2, C3k2, [1024, True]] # 22 (P5/32-large)
    
      - [[16, 19, 22], 1, Detect, [nc]] # Detect(P3, P4, P5)
    

**YOLO11å’ŒYOLOv8 yamlæ–‡ä»¶çš„åŒºåˆ«**

![](https://i-blog.csdnimg.cn/direct/a8f3766a015c4ad2a49411ab710b3477.png)

##### æ”¹è¿›æ¨¡å—ä»£ç 

  * C3k2 

    
    
    class C3k2(C2f):
        """Faster Implementation of CSP Bottleneck with 2 convolutions."""
    
        def __init__(self, c1, c2, n=1, c3k=False, e=0.5, g=1, shortcut=True):
            """Initializes the C3k2 module, a faster CSP Bottleneck with 2 convolutions and optional C3k blocks."""
            super().__init__(c1, c2, n, shortcut, g, e)
            self.m = nn.ModuleList(
                C3k(self.c, self.c, 2, shortcut, g) if c3k else Bottleneck(self.c, self.c, shortcut, g) for _ in range(n)
            )

C3k2ï¼Œå®ƒæ˜¯å…·æœ‰ä¸¤ä¸ªå·ç§¯çš„CSPï¼ˆPartial Cross Stageï¼‰ç“¶é¢ˆæ¶æ„çš„æ›´å¿«å®ç°ã€‚

**ç±»ç»§æ‰¿ï¼š**

  * `C3k2`ç»§æ‰¿è‡ªç±»`C2f`ã€‚è¿™è¡¨æ˜`C2f`å¾ˆå¯èƒ½å®ç°äº†ç»è¿‡ä¿®æ”¹çš„åŸºæœ¬CSPç»“æ„ï¼Œè€Œ`C3k2`è¿›ä¸€æ­¥ä¼˜åŒ–æˆ–ä¿®æ”¹äº†æ­¤ç»“æ„ã€‚

**æ„é€ å‡½æ•°ï¼ˆ`__init__`ï¼‰ï¼š**

  * `c1`ï¼šè¾“å…¥é€šé“ã€‚

  * `c2`ï¼šè¾“å‡ºé€šé“ã€‚

  * `n`ï¼šç“¶é¢ˆå±‚æ•°ï¼ˆé»˜è®¤ä¸º1ï¼‰ã€‚

  * `c3k`ï¼šä¸€ä¸ªå¸ƒå°”æ ‡å¿—ï¼Œç¡®å®šæ˜¯å¦ä½¿ç”¨`C3k`å—æˆ–å¸¸è§„`Bottleneck`å—ã€‚

  * `e`ï¼šæ‰©å±•æ¯”ç‡ï¼Œæ§åˆ¶éšè—å±‚çš„å®½åº¦ï¼ˆé»˜è®¤ä¸º0.5ï¼‰ã€‚

  * `g`ï¼šåˆ†ç»„å·ç§¯çš„ç»„å½’ä¸€åŒ–å‚æ•°æˆ–ç»„æ•°ï¼ˆé»˜è®¤å€¼ä¸º 1ï¼‰ã€‚

  * `shortcut`ï¼šä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç”¨äºç¡®å®šæ˜¯å¦åœ¨ç½‘ç»œä¸­åŒ…å«å¿«æ·æ–¹å¼è¿æ¥ï¼ˆé»˜è®¤å€¼ä¸º `True`ï¼‰ã€‚

**åˆå§‹åŒ–ï¼š**

  * `super().__init__(c1, c2, n, short-cut, g, e)` è°ƒç”¨çˆ¶ç±» `C2f` çš„æ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–æ ‡å‡† CSP ç»„ä»¶ï¼Œå¦‚é€šé“æ•°ã€å¿«æ·æ–¹å¼ã€ç»„ç­‰ã€‚

**æ¨¡å—åˆ—è¡¨ï¼ˆ`self.m`ï¼‰ï¼š**

  * `nn.ModuleList` å­˜å‚¨ `C3k` æˆ– `Bottleneck` æ¨¡å—ï¼Œå…·ä½“å–å†³äº `c3k` çš„å€¼ã€‚

  * å¦‚æœ `c3k` ä¸º `True`ï¼Œå®ƒä¼šåˆå§‹åŒ– `C3k` æ¨¡å—ã€‚`C3k` æ¨¡å—æ¥æ”¶ä»¥ä¸‹å‚æ•°ï¼š

  * `self.c`ï¼šé€šé“æ•°ï¼ˆæºè‡ª `C2f`ï¼‰ã€‚

  * `2`ï¼šè¿™è¡¨ç¤ºåœ¨ `C3k` å—å†…ä½¿ç”¨äº†ä¸¤ä¸ªå·ç§¯å±‚ã€‚

  * `shortcut` å’Œ `g`ï¼šä» `C3k2` æ„é€ å‡½æ•°ä¼ é€’ã€‚

  * å¦‚æœ `c3k` ä¸º `False`ï¼Œåˆ™åˆå§‹åŒ–æ ‡å‡† `Bottleneck` æ¨¡å—ã€‚

`for _ in range(n)` è¡¨ç¤ºå°†åˆ›å»º `n` ä¸ªè¿™æ ·çš„å—ã€‚

**æ€»ç»“ï¼š**

  * `C3k2` å®ç°äº† CSP ç“¶é¢ˆæ¶æ„ï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨è‡ªå®šä¹‰ `C3k` å—ï¼ˆå…·æœ‰ä¸¤ä¸ªå·ç§¯ï¼‰æˆ–æ ‡å‡† `Bottleneck` å—ï¼Œå…·ä½“å–å†³äº `c3k` æ ‡å¿—ã€‚

  * C2PSA

    
    
    class C2PSA(nn.Module):
        """
        C2PSA module with attention mechanism for enhanced feature extraction and processing.
    
        This module implements a convolutional block with attention mechanisms to enhance feature extraction and processing
        capabilities. It includes a series of PSABlock modules for self-attention and feed-forward operations.
    
        Attributes:
            c (int): Number of hidden channels.
            cv1 (Conv): 1x1 convolution layer to reduce the number of input channels to 2*c.
            cv2 (Conv): 1x1 convolution layer to reduce the number of output channels to c.
            m (nn.Sequential): Sequential container of PSABlock modules for attention and feed-forward operations.
    
        Methods:
            forward: Performs a forward pass through the C2PSA module, applying attention and feed-forward operations.
    
        Notes:
            This module essentially is the same as PSA module, but refactored to allow stacking more PSABlock modules.
    
        Examples:
            >>> c2psa = C2PSA(c1=256, c2=256, n=3, e=0.5)
            >>> input_tensor = torch.randn(1, 256, 64, 64)
            >>> output_tensor = c2psa(input_tensor)
        """
    
        def __init__(self, c1, c2, n=1, e=0.5):
            """Initializes the C2PSA module with specified input/output channels, number of layers, and expansion ratio."""
            super().__init__()
            assert c1 == c2
            self.c = int(c1 * e)
            self.cv1 = Conv(c1, 2 * self.c, 1, 1)
            self.cv2 = Conv(2 * self.c, c1, 1)
    
            self.m = nn.Sequential(*(PSABlock(self.c, attn_ratio=0.5, num_heads=self.c // 64) for _ in range(n)))
    
        def forward(self, x):
            """Processes the input tensor 'x' through a series of PSA blocks and returns the transformed tensor."""
            a, b = self.cv1(x).split((self.c, self.c), dim=1)
            b = self.m(b)
            return self.cv2(torch.cat((a, b), 1))

`C2PSA` æ¨¡å—æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰ç¥ç»ç½‘ç»œå±‚ï¼Œå¸¦æœ‰æ³¨æ„åŠ›æœºåˆ¶ï¼Œç”¨äºå¢å¼ºç‰¹å¾æå–å’Œå¤„ç†ã€‚

**ç±»æ¦‚è¿°**

  * **ç›®çš„ï¼š**

  * `C2PSA` æ¨¡å—å¼•å…¥äº†ä¸€ä¸ªå·ç§¯å—ï¼Œåˆ©ç”¨æ³¨æ„åŠ›æœºåˆ¶æ¥æ”¹è¿›ç‰¹å¾æå–å’Œå¤„ç†ã€‚

  * å®ƒä½¿ç”¨ä¸€ç³»åˆ— `PSABlock` æ¨¡å—ï¼Œè¿™äº›æ¨¡å—å¯èƒ½ä»£è¡¨æŸç§å½¢å¼çš„ä½ç½®è‡ªæ³¨æ„åŠ› (PSA)ï¼Œå¹¶ä¸”è¯¥æ¶æ„æ—¨åœ¨å…è®¸å †å å¤šä¸ª `PSABlock` å±‚ã€‚

**æ„é€ å‡½æ•°ï¼ˆ`__init__`ï¼‰ï¼š**

  * **å‚æ•°ï¼š**

  * `c1`ï¼šè¾“å…¥é€šé“ï¼ˆå¿…é¡»ç­‰äº `c2`ï¼‰ã€‚

  * `c2`ï¼šè¾“å‡ºé€šé“ï¼ˆå¿…é¡»ç­‰äº `c1`ï¼‰ã€‚

  * `n`ï¼šè¦å †å çš„ `PSABlock` æ¨¡å—æ•°é‡ï¼ˆé»˜è®¤å€¼ä¸º 1ï¼‰ã€‚

  * `e`ï¼šæ‰©å±•æ¯”ç‡ï¼Œç”¨äºè®¡ç®—éšè—é€šé“çš„æ•°é‡ï¼ˆé»˜è®¤å€¼ä¸º 0.5ï¼‰ã€‚

  * **å±æ€§ï¼š**

  * `self.c`ï¼šéšè—é€šé“æ•°ï¼Œè®¡ç®—ä¸º `int(c1 * e)`ã€‚

  * `self.cv1`ï¼šä¸€ä¸ª `1x1` å·ç§¯ï¼Œå°†è¾“å…¥é€šé“æ•°ä» `c1` å‡å°‘åˆ° `2 * self.c`ã€‚è¿™ä¸ºå°†è¾“å…¥åˆ†æˆä¸¤éƒ¨åˆ†åšå¥½å‡†å¤‡ã€‚

  * `self.cv2`ï¼šå¦ä¸€ä¸ª `1x1` å·ç§¯ï¼Œå¤„ç†åå°†é€šé“ç»´åº¦æ¢å¤å› `c1`ã€‚

  * `self.m`ï¼šä¸€ç³»åˆ— `PSABlock` æ¨¡å—ã€‚æ¯ä¸ª `PSABlock` æ¥æ”¶ `self.c` é€šé“ï¼Œæ³¨æ„å¤´çš„æ•°é‡ä¸º `self.c // 64`ã€‚æ¯ä¸ªå—åº”ç”¨æ³¨æ„å’Œå‰é¦ˆæ“ä½œã€‚

**å‰å‘æ–¹æ³•ï¼š**

  * **è¾“å…¥ï¼š**

  * `x`ï¼Œè¾“å…¥å¼ é‡ã€‚

  * **æ“ä½œï¼š**

  1. `self.cv1(x)` åº”ç”¨ `1x1` å·ç§¯ï¼Œå°†è¾“å…¥é€šé“å¤§å°ä» `c1` å‡å°åˆ° `2 * self.c`ã€‚

  2. ç”Ÿæˆçš„å¼ é‡æ²¿é€šé“ç»´åº¦åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œ`a` å’Œ `b`ã€‚

  * `a`ï¼šç¬¬ä¸€ä¸ª `self.c` é€šé“ã€‚

  * `b`ï¼šå‰©ä½™çš„ `self.c` é€šé“ã€‚

  1. `b` é€šè¿‡é¡ºåºå®¹å™¨ `self.m`ï¼Œå®ƒæ˜¯ `PSABlock` æ¨¡å—çš„å †æ ˆã€‚è¿™éƒ¨åˆ†ç»è¿‡åŸºäºæ³¨æ„çš„å¤„ç†ã€‚

  2. å¤„ç†åçš„å¼ é‡ `b` ä¸ `a` è¿æ¥ã€‚

  3. `self.cv2` åº”ç”¨ `1x1` å·ç§¯ï¼Œå°†é€šé“å¤§å°æ¢å¤ä¸º `c1`ã€‚

  * **è¾“å‡ºï¼š**

  * åº”ç”¨æ³¨æ„å’Œå·ç§¯æ“ä½œåçš„å˜æ¢åçš„å¼ é‡ã€‚

**æ€»ç»“ï¼š**

  * **C2PSA** æ˜¯ä¸€ä¸ªå¢å¼ºå‹å·ç§¯æ¨¡å—ï¼Œå®ƒé€šè¿‡å †å çš„ `PSABlock` æ¨¡å—åº”ç”¨ä½ç½®è‡ªæ³¨æ„åŠ›ã€‚å®ƒæ‹†åˆ†è¾“å…¥å¼ é‡ï¼Œå°†æ³¨æ„åŠ›åº”ç”¨äºå…¶ä¸­ä¸€éƒ¨åˆ†ï¼Œç„¶åé‡æ–°ç»„åˆå¹¶é€šè¿‡æœ€ç»ˆå·ç§¯å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚æ­¤ç»“æ„æœ‰åŠ©äºä»è¾“å…¥æ•°æ®ä¸­æå–å¤æ‚ç‰¹å¾ã€‚

##### ç½‘ç»œç»“æ„

![](https://i-blog.csdnimg.cn/direct/761af09befeb45adafae36b679424b26.png)

![](https://i-blog.csdnimg.cn/direct/45e481e295ad458fa7fe4c252fbd5d83.png)




### 8.200+ç§å…¨å¥—æ”¹è¿›YOLOV11åˆ›æ–°ç‚¹åŸç†è®²è§£

#### 8.1 200+ç§å…¨å¥—æ”¹è¿›YOLOV11åˆ›æ–°ç‚¹åŸç†è®²è§£å¤§å…¨

ç”±äºç¯‡å¹…é™åˆ¶ï¼Œæ¯ä¸ªåˆ›æ–°ç‚¹çš„å…·ä½“åŸç†è®²è§£å°±ä¸å…¨éƒ¨å±•å¼€ï¼Œå…·ä½“è§ä¸‹åˆ—ç½‘å€ä¸­çš„æ”¹è¿›æ¨¡å—å¯¹åº”é¡¹ç›®çš„æŠ€æœ¯åŸç†åšå®¢ç½‘å€ã€Blogã€‘ï¼ˆåˆ›æ–°ç‚¹å‡ä¸ºæ¨¡å—åŒ–æ­å»ºï¼ŒåŸç†é€‚é…YOLOv5~YOLOv11ç­‰å„ç§ç‰ˆæœ¬ï¼‰

[æ”¹è¿›æ¨¡å—æŠ€æœ¯åŸç†åšå®¢ã€Blogã€‘ç½‘å€é“¾æ¥](https://gitee.com/qunmasj/good)

![9.png](9.png)

#### 8.2 ç²¾é€‰éƒ¨åˆ†æ”¹è¿›YOLOV11åˆ›æ–°ç‚¹åŸç†è®²è§£

###### è¿™é‡ŒèŠ‚é€‰éƒ¨åˆ†æ”¹è¿›åˆ›æ–°ç‚¹å±•å¼€åŸç†è®²è§£(å®Œæ•´çš„æ”¹è¿›åŸç†è§ä¸Šå›¾å’Œ[æ”¹è¿›æ¨¡å—æŠ€æœ¯åŸç†åšå®¢é“¾æ¥](https://gitee.com/qunmasj/good)ã€å¦‚æœæ­¤å°èŠ‚çš„å›¾åŠ è½½å¤±è´¥å¯ä»¥é€šè¿‡CSDNæˆ–è€…Githubæœç´¢è¯¥åšå®¢çš„æ ‡é¢˜è®¿é—®åŸå§‹åšå®¢ï¼ŒåŸå§‹åšå®¢å›¾ç‰‡æ˜¾ç¤ºæ­£å¸¸ã€‘
ï»¿
### RT-DETRéª¨å¹²ç½‘ç»œHGNetv2ç®€ä»‹
#### RT-DETRæ¨ªç©ºå‡ºä¸–
å‰å‡ å¤©è¢«ç™¾åº¦çš„RT-DETRåˆ·å±ï¼Œå‚è€ƒè¯¥åšå®¢æå‡ºçš„ç›®æ ‡æ£€æµ‹æ–°èŒƒå¼å¯¹åŸå§‹DETRçš„ç½‘ç»œç»“æ„è¿›è¡Œäº†è°ƒæ•´å’Œä¼˜åŒ–ï¼Œä»¥æé«˜è®¡ç®—é€Ÿåº¦å’Œå‡å°æ¨¡å‹å¤§å°ã€‚è¿™åŒ…æ‹¬ä½¿ç”¨æ›´è½»é‡çº§çš„åŸºç¡€ç½‘ç»œå’Œè°ƒæ•´Transformerç»“æ„ã€‚å¹¶ä¸”ï¼Œæ‘’å¼ƒäº†nmså¤„ç†çš„detrç»“æ„ä¸ä¼ ç»Ÿçš„ç‰©ä½“æ£€æµ‹æ–¹æ³•ç›¸æ¯”ï¼Œä¸ä»…è®­ç»ƒæ˜¯ç«¯åˆ°ç«¯çš„ï¼Œæ£€æµ‹ä¹Ÿèƒ½ç«¯åˆ°ç«¯ï¼Œè¿™æ„å‘³ç€æ•´ä¸ªç½‘ç»œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä¸€èµ·è¿›è¡Œä¼˜åŒ–ï¼Œæ¨ç†è¿‡ç¨‹ä¸éœ€è¦æ˜‚è´µçš„åå¤„ç†ä»£ä»·ï¼Œè¿™æœ‰åŠ©äºæé«˜æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›å’Œæ€§èƒ½ã€‚



å½“ç„¶ï¼Œäººä»¬å¯¹RT-DETRä¹‹æ‰€ä»¥äº§ç”Ÿæµ“åšçš„å…´è¶£ï¼Œæˆ‘è§‰å¾—å¤§æ¦‚ç‡è¿˜æ˜¯å¯¹YOLOç³»åˆ—å®¡ç¾ç–²åŠ³äº†ï¼Œå°±ç®—æ˜¯å‡ºåˆ°äº†YOLO10086ï¼Œæˆ‘è¿˜æ˜¯åªæƒ³ç”¨YOLOv11å’ŒYOLOv11çš„æ¡†æ¶æ¥é­”æ”¹åšä¸šåŠ¡ã€‚ã€‚

#### åˆè¯†HGNet
çœ‹åˆ°RT-DETRçš„æ€§èƒ½æŒ‡æ ‡ï¼Œå‘ç°æŒ‡æ ‡æœ€å¥½çš„ä¸¤ä¸ªæ¨¡å‹backboneéƒ½æ˜¯ç”¨çš„HGNetv2ï¼Œæ¯«æ— ç–‘é—®ï¼Œå’Œå½“æ—¶çš„picodetä¸€æ ·ï¼Œéª¨å¹²éƒ½æ˜¯ä½¿ç”¨ç™¾åº¦è‡ªå®¶çš„ç½‘ç»œã€‚åˆè¯†HGNetçš„æ—¶å€™ï¼Œå½“æ—¶æ˜¯å‚åŠ äº†ç¬¬å››å±Šç™¾åº¦ç½‘ç›˜å›¾åƒå¤„ç†å¤§èµ›ï¼Œæ–‡æ¡£å›¾åƒæ–¹å‘è¯†åˆ«ä¸“é¢˜èµ›é“ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯ä½¿ç”¨åˆ†ç±»ç½‘ç»œå¯¹ä¸€äº›æ–‡æ¡£æˆªå›¾æˆ–è€…å›¾ç‰‡è¿›è¡Œæ–¹å‘è§’åº¦åˆ†ç±»ã€‚



å½“æ—¶çš„æ–¹æ¡ˆå¹¶æ²¡æœ‰é‚£ä¹ˆå¿«å®šå‹ï¼Œé€šå¸¸æ˜¯æ‰“æ¦œè¿‡ç¨‹å‘ç°å“ªä¸ªç½‘ç»œæ€§èƒ½å¥½å°±ä½¿ç”¨å“ªä¸ªç½‘ç»œåšé­”æ”¹ï¼Œè€Œä¸”æœ¨æœ‰æ˜¾å¡ï¼Œåªèƒ½è¹­Ai Studioçš„å¹³å°ï¼Œä¸è¿‡v100ä¸€å¤©8å°æ—¶çš„å®éªŒæ—¶é—´æœ‰ç‚¹çŸ­ï¼Œè¿™ä¹Ÿæ³¨å®šäº†å¤§æ¨¡å‹ç”¨ä¸äº†ã€‚ 

æµæ°´çš„æ¨¡å‹ï¼Œé“æ‰“çš„ç‚¼ä¸¹äººï¼Œæœ€åå‘ç°HGNet-tinyå„æ–¹é¢æŒ‡æ ‡éƒ½å¾ˆç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸï¼Œåé¢å°±ä¸€ç›´å›´ç»•å®ƒé­”æ”¹ã€‚å½“ç„¶ï¼Œæ¯”èµ›æ‰“æ¦œæ˜¯ç›®çš„ï¼Œå­¦ä¹ æ‰æ˜¯äº«å—è¿‡ç¨‹ï¼Œå½“æ—¶çœ‹åˆ°æ•ˆæœè¿˜å¯ä»¥ï¼Œä¾¿å¼€å§‹æŠ˜è…¾èµ·äº†HGNetçš„ç½‘ç»œæ¶æ„ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒPP-HGNet é’ˆå¯¹ GPU è®¾å¤‡ï¼Œå¯¹ç›®å‰ GPU å‹å¥½çš„ç½‘ç»œåšäº†åˆ†æå’Œå½’çº³ï¼Œå°½å¯èƒ½å¤šçš„ä½¿ç”¨ 3x3 æ ‡å‡†å·ç§¯ï¼ˆè®¡ç®—å¯†åº¦æœ€é«˜ï¼‰ï¼ŒPP-HGNetæ˜¯ç”±å¤šä¸ªHG-Blockç»„æˆï¼Œç»†èŠ‚å¦‚ä¸‹ï¼š



ConvBNActæ˜¯å•¥ï¼Ÿç®€å•èŠä¸€èŠï¼Œå°±æ˜¯Conv+BN+Actï¼ŒCV Manåº”è¯¥æœ€ç†Ÿæ‚‰ä¸è¿‡äº†ï¼š
```python
class ConvBNAct(TheseusLayer):
    def __init__(self,
                 in_channels,
                 out_channels,
                 kernel_size,
                 stride,
                 groups=1,
                 use_act=True):
        super().__init__()
        self.use_act = use_act
        self.conv = Conv2D(
            in_channels,
            out_channels,
            kernel_size,
            stride,
            padding=(kernel_size - 1) // 2,
            groups=groups,
            bias_attr=False)
        self.bn = BatchNorm2D(
            out_channels,
            weight_attr=ParamAttr(regularizer=L2Decay(0.0)),
            bias_attr=ParamAttr(regularizer=L2Decay(0.0)))
        if self.use_act:
            self.act = ReLU()
 
    def forward(self, x):
        x = self.conv(x)
        x = self.bn(x)
        if self.use_act:
            x = self.act(x)
        return x 
```
ä¸”æ ‡å‡†å·ç§¯çš„æ•°é‡éšå±‚æ•°æ·±åº¦å¢åŠ è€Œå¢å¤šï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªæœ‰åˆ©äº GPU æ¨ç†çš„éª¨å¹²ç½‘ç»œï¼ŒåŒæ ·é€Ÿåº¦ä¸‹ï¼Œç²¾åº¦ä¹Ÿè¶…è¶Šå…¶ä»– CNN ï¼Œæ€§ä»·æ¯”ä¹Ÿä¼˜äºViT-baseæ¨¡å‹ã€‚



å¦å¤–ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š

PP-HGNet çš„ç¬¬ä¸€å±‚ç”±channelä¸º96çš„Stemæ¨¡å—æ„æˆï¼Œç›®çš„æ˜¯ä¸ºäº†å‡å°‘å‚æ•°é‡å’Œè®¡ç®—é‡ã€‚PP-HGNet

Tinyçš„æ•´ä½“ç»“æ„ç”±å››ä¸ªHG Stageæ„æˆï¼Œè€Œæ¯ä¸ªHG Stageä¸»è¦ç”±åŒ…å«å¤§é‡æ ‡å‡†å·ç§¯çš„HG Blockæ„æˆã€‚

PP-HGNetçš„ç¬¬ä¸‰åˆ°ç¬¬äº”å±‚ä½¿ç”¨äº†ä½¿ç”¨äº†å¯å­¦ä¹ çš„ä¸‹é‡‡æ ·å±‚ï¼ˆLDS Layerï¼‰ï¼Œè¯¥å±‚groupä¸ºè¾“å…¥é€šé“æ•°ï¼Œå¯è¾¾åˆ°é™å‚é™è®¡ç®—é‡çš„ä½œç”¨ï¼Œä¸”Tinyæ¨¡å‹ä»…åŒ…å«ä¸‰ä¸ªLDS Layerï¼Œå¹¶ä¸ä¼šå¯¹GPUçš„åˆ©ç”¨ç‡é€ æˆè¾ƒå¤§å½±å“.

PP-HGNetçš„æ¿€æ´»å‡½æ•°ä¸ºReluï¼Œå¸¸æ•°çº§æ“ä½œå¯ä¿è¯è¯¥æ¨¡å‹åœ¨ç¡¬ä»¶ä¸Šçš„æ¨ç†é€Ÿåº¦ã€‚

### 9.ç³»ç»ŸåŠŸèƒ½å±•ç¤º

å›¾9.1.ç³»ç»Ÿæ”¯æŒæ£€æµ‹ç»“æœè¡¨æ ¼æ˜¾ç¤º

  å›¾9.2.ç³»ç»Ÿæ”¯æŒç½®ä¿¡åº¦å’ŒIOUé˜ˆå€¼æ‰‹åŠ¨è°ƒèŠ‚

  å›¾9.3.ç³»ç»Ÿæ”¯æŒè‡ªå®šä¹‰åŠ è½½æƒé‡æ–‡ä»¶best.pt(éœ€è¦ä½ é€šè¿‡æ­¥éª¤5ä¸­è®­ç»ƒè·å¾—)

  å›¾9.4.ç³»ç»Ÿæ”¯æŒæ‘„åƒå¤´å®æ—¶è¯†åˆ«

  å›¾9.5.ç³»ç»Ÿæ”¯æŒå›¾ç‰‡è¯†åˆ«

  å›¾9.6.ç³»ç»Ÿæ”¯æŒè§†é¢‘è¯†åˆ«

  å›¾9.7.ç³»ç»Ÿæ”¯æŒè¯†åˆ«ç»“æœæ–‡ä»¶è‡ªåŠ¨ä¿å­˜

  å›¾9.8.ç³»ç»Ÿæ”¯æŒExcelå¯¼å‡ºæ£€æµ‹ç»“æœæ•°æ®

![10.png](10.png)

![11.png](11.png)

![12.png](12.png)

![13.png](13.png)

![14.png](14.png)

![15.png](15.png)

![16.png](16.png)

![17.png](17.png)

### 10. YOLOv11æ ¸å¿ƒæ”¹è¿›æºç è®²è§£

#### 10.1 head.py

ä»¥ä¸‹æ˜¯ç»è¿‡ç®€åŒ–å’Œæ³¨é‡Šçš„æ ¸å¿ƒä»£ç éƒ¨åˆ†ï¼Œä¸»è¦ä¿ç•™äº† `Detect_DyHead` ç±»åŠå…¶ç›¸å…³çš„æ ¸å¿ƒåŠŸèƒ½ã€‚ä»£ç ä¸­çš„æ³¨é‡Šè§£é‡Šäº†æ¯ä¸ªéƒ¨åˆ†çš„åŠŸèƒ½å’Œç›®çš„ã€‚

```python
import torch
import torch.nn as nn
import math

class Detect_DyHead(nn.Module):
    """YOLOv8 æ£€æµ‹å¤´ï¼Œä½¿ç”¨åŠ¨æ€å¤´è¿›è¡Œæ£€æµ‹æ¨¡å‹ã€‚"""
    
    def __init__(self, nc=80, hidc=256, block_num=2, ch=()):
        """åˆå§‹åŒ–æ£€æµ‹å±‚ã€‚
        
        å‚æ•°:
        nc (int): ç±»åˆ«æ•°é‡ã€‚
        hidc (int): éšè—å±‚é€šé“æ•°ã€‚
        block_num (int): åŠ¨æ€å¤´å—çš„æ•°é‡ã€‚
        ch (tuple): è¾“å…¥é€šé“æ•°ã€‚
        """
        super().__init__()
        self.nc = nc  # ç±»åˆ«æ•°é‡
        self.nl = len(ch)  # æ£€æµ‹å±‚æ•°é‡
        self.reg_max = 16  # DFL é€šé“æ•°
        self.no = nc + self.reg_max * 4  # æ¯ä¸ªé”šç‚¹çš„è¾“å‡ºæ•°é‡
        self.stride = torch.zeros(self.nl)  # åœ¨æ„å»ºæ—¶è®¡ç®—çš„æ­¥å¹…
        
        # è®¡ç®—é€šé“æ•°
        c2, c3 = max((16, ch[0] // 4, self.reg_max * 4)), max(ch[0], self.nc)
        
        # å®šä¹‰å·ç§¯å±‚
        self.conv = nn.ModuleList(nn.Sequential(Conv(x, hidc, 1)) for x in ch)
        self.dyhead = nn.Sequential(*[DyHeadBlock(hidc) for _ in range(block_num)])  # åŠ¨æ€å¤´å—
        
        # å®šä¹‰åç»­å·ç§¯å±‚
        self.cv2 = nn.ModuleList(
            nn.Sequential(Conv(hidc, c2, 3), Conv(c2, c2, 3), nn.Conv2d(c2, 4 * self.reg_max, 1)) for _ in ch
        )
        self.cv3 = nn.ModuleList(
            nn.Sequential(
                nn.Sequential(DWConv(hidc, x, 3), Conv(x, c3, 1)),
                nn.Sequential(DWConv(c3, c3, 3), Conv(c3, c3, 1)),
                nn.Conv2d(c3, self.nc, 1),
            )
            for x in ch
        )
        self.dfl = DFL(self.reg_max) if self.reg_max > 1 else nn.Identity()  # DFL å±‚

    def forward(self, x):
        """è¿æ¥å¹¶è¿”å›é¢„æµ‹çš„è¾¹ç•Œæ¡†å’Œç±»åˆ«æ¦‚ç‡ã€‚"""
        for i in range(self.nl):
            x[i] = self.conv[i](x[i])  # åº”ç”¨å·ç§¯å±‚
        x = self.dyhead(x)  # åº”ç”¨åŠ¨æ€å¤´
        
        shape = x[0].shape  # è·å–å½¢çŠ¶
        for i in range(self.nl):
            # è¿æ¥ cv2 å’Œ cv3 çš„è¾“å‡º
            x[i] = torch.cat((self.cv2[i](x[i]), self.cv3[i](x[i])), 1)
        
        if self.training:
            return x  # è®­ç»ƒæ¨¡å¼ä¸‹è¿”å›ä¸­é—´ç»“æœ
        
        # åŠ¨æ€æ¨¡å¼æˆ–å½¢çŠ¶å‘ç”Ÿå˜åŒ–æ—¶æ›´æ–°é”šç‚¹å’Œæ­¥å¹…
        if self.dynamic or self.shape != shape:
            self.anchors, self.strides = (x.transpose(0, 1) for x in make_anchors(x, self.stride, 0.5))
            self.shape = shape

        # åˆå¹¶æ‰€æœ‰æ£€æµ‹å±‚çš„è¾“å‡º
        x_cat = torch.cat([xi.view(shape[0], self.no, -1) for xi in x], 2)
        box, cls = x_cat.split((self.reg_max * 4, self.nc), 1)  # åˆ†å‰²è¾¹ç•Œæ¡†å’Œç±»åˆ«
        
        # è®¡ç®—è§£ç åçš„è¾¹ç•Œæ¡†
        dbox = dist2bbox(self.dfl(box), self.anchors.unsqueeze(0), xywh=True, dim=1) * self.strides
        y = torch.cat((dbox, cls.sigmoid()), 1)  # åˆå¹¶è¾¹ç•Œæ¡†å’Œç±»åˆ«æ¦‚ç‡
        return y  # è¿”å›æœ€ç»ˆç»“æœ

    def bias_init(self):
        """åˆå§‹åŒ–æ£€æµ‹å¤´çš„åç½®ï¼Œè­¦å‘Šï¼šéœ€è¦æ­¥å¹…å¯ç”¨ã€‚"""
        for a, b, s in zip(self.cv2, self.cv3, self.stride):
            a[-1].bias.data[:] = 1.0  # è¾¹ç•Œæ¡†åç½®
            b[-1].bias.data[:self.nc] = math.log(5 / self.nc / (640 / s) ** 2)  # ç±»åˆ«åç½®
```

### ä»£ç è¯´æ˜
1. **ç±» `Detect_DyHead`**: è¿™æ˜¯ YOLOv8 çš„æ£€æµ‹å¤´ï¼Œä½¿ç”¨åŠ¨æ€å¤´è¿›è¡Œç›®æ ‡æ£€æµ‹ã€‚
2. **`__init__` æ–¹æ³•**: åˆå§‹åŒ–æ£€æµ‹å¤´çš„å‚æ•°ï¼ŒåŒ…æ‹¬ç±»åˆ«æ•°é‡ã€éšè—å±‚é€šé“æ•°ã€åŠ¨æ€å¤´å—æ•°é‡ç­‰ã€‚å®šä¹‰äº†å¤šä¸ªå·ç§¯å±‚å’ŒåŠ¨æ€å¤´å—ã€‚
3. **`forward` æ–¹æ³•**: å®šä¹‰äº†å‰å‘ä¼ æ’­è¿‡ç¨‹ï¼Œè®¡ç®—è¾“å…¥çš„ç‰¹å¾å›¾å¹¶è¿”å›é¢„æµ‹çš„è¾¹ç•Œæ¡†å’Œç±»åˆ«æ¦‚ç‡ã€‚
4. **`bias_init` æ–¹æ³•**: åˆå§‹åŒ–åç½®å€¼ï¼Œç¡®ä¿æ¨¡å‹åœ¨è®­ç»ƒæ—¶èƒ½å¤Ÿæ›´å¥½åœ°æ”¶æ•›ã€‚

è¯¥ä»£ç æ®µæ˜¯ YOLOv8 æ£€æµ‹æ¨¡å‹çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œè´Ÿè´£å¤„ç†è¾“å…¥ç‰¹å¾å¹¶ç”Ÿæˆæœ€ç»ˆçš„æ£€æµ‹ç»“æœã€‚

è¯¥æ–‡ä»¶ `head.py` æ˜¯ä¸€ä¸ªå®ç° YOLOv8 æ£€æµ‹å¤´çš„æ¨¡å—ï¼Œä¸»è¦ç”¨äºç›®æ ‡æ£€æµ‹ä»»åŠ¡ã€‚æ–‡ä»¶ä¸­å®šä¹‰äº†å¤šä¸ªç±»ï¼Œè¿™äº›ç±»ç»§æ‰¿è‡ª `torch.nn.Module`ï¼Œå¹¶å®ç°äº†ä¸åŒçš„æ£€æµ‹å¤´ç»“æ„ã€‚ä»¥ä¸‹æ˜¯å¯¹æ–‡ä»¶ä¸­ä¸»è¦å†…å®¹çš„é€æ­¥åˆ†æå’Œè¯´æ˜ã€‚

é¦–å…ˆï¼Œæ–‡ä»¶å¯¼å…¥äº†ä¸€äº›å¿…è¦çš„åº“ï¼ŒåŒ…æ‹¬ `torch` å’Œ `torch.nn`ï¼Œä»¥åŠä¸€äº›è‡ªå®šä¹‰æ¨¡å—å’Œå‡½æ•°ã€‚è¿™äº›å¯¼å…¥çš„æ¨¡å—æä¾›äº†æ„å»ºç¥ç»ç½‘ç»œæ‰€éœ€çš„åŸºç¡€ç»„ä»¶å’ŒåŠŸèƒ½ã€‚

æ¥ä¸‹æ¥ï¼Œæ–‡ä»¶å®šä¹‰äº†å¤šä¸ªæ£€æµ‹å¤´ç±»ã€‚æ¯ä¸ªç±»éƒ½åŒ…å«äº†ç½‘ç»œçš„åˆå§‹åŒ–æ–¹æ³•å’Œå‰å‘ä¼ æ’­æ–¹æ³•ã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªä¸»è¦ç±»çš„ä»‹ç»ï¼š

1. **Detect_DyHead**ï¼šè¿™æ˜¯ YOLOv8 çš„åŠ¨æ€æ£€æµ‹å¤´ï¼Œæ”¯æŒåŠ¨æ€è°ƒæ•´ç½‘æ ¼ç»“æ„ã€‚å®ƒçš„æ„é€ å‡½æ•°æ¥å—ç±»åˆ«æ•°ã€éšè—é€šé“æ•°ã€å—æ•°å’Œé€šé“ä¿¡æ¯ï¼Œå¹¶åˆå§‹åŒ–ç›¸åº”çš„å·ç§¯å±‚å’ŒåŠ¨æ€å¤´æ¨¡å—ã€‚å‰å‘ä¼ æ’­æ–¹æ³•ä¸­ï¼Œè¾“å…¥ç»è¿‡å·ç§¯å’ŒåŠ¨æ€å¤´å¤„ç†åï¼Œè¾“å‡ºè¾¹ç•Œæ¡†å’Œç±»åˆ«æ¦‚ç‡ã€‚

2. **Detect_AFPN_P345**ï¼šè¿™æ˜¯ä¸€ä¸ªä½¿ç”¨è‡ªé€‚åº”ç‰¹å¾é‡‘å­—å¡”ç½‘ç»œï¼ˆAFPNï¼‰çš„æ£€æµ‹å¤´ã€‚å®ƒåœ¨åˆå§‹åŒ–æ—¶æ„å»ºäº† AFPN æ¨¡å—ï¼Œå¹¶å®šä¹‰äº†ä¸¤ä¸ªå·ç§¯å±‚åºåˆ—ç”¨äºè¾¹ç•Œæ¡†å’Œç±»åˆ«çš„é¢„æµ‹ã€‚å‰å‘ä¼ æ’­æ–¹æ³•ç±»ä¼¼äº `Detect_DyHead`ï¼Œä½†ä½¿ç”¨äº† AFPN çš„ç‰¹å¾ã€‚

3. **Detect_Efficient**ï¼šè¿™æ˜¯ä¸€ä¸ªé«˜æ•ˆçš„æ£€æµ‹å¤´ï¼Œé‡‡ç”¨äº†è½»é‡çº§çš„å·ç§¯ç»“æ„ã€‚å®ƒçš„è®¾è®¡ç›®æ ‡æ˜¯å‡å°‘è®¡ç®—é‡ï¼ŒåŒæ—¶ä¿æŒæ£€æµ‹æ€§èƒ½ã€‚å®ƒçš„å‰å‘ä¼ æ’­æ–¹æ³•å¤„ç†è¾“å…¥ç‰¹å¾å¹¶è¾“å‡ºé¢„æµ‹ç»“æœã€‚

4. **DetectAux**ï¼šè¿™æ˜¯ä¸€ä¸ªå¸¦æœ‰è¾…åŠ©å¤´çš„æ£€æµ‹æ¨¡å—ï¼Œæ—¨åœ¨æé«˜æ£€æµ‹æ€§èƒ½ã€‚å®ƒåœ¨å‰å‘ä¼ æ’­ä¸­å¤„ç†ä¸»æ£€æµ‹å¤´å’Œè¾…åŠ©æ£€æµ‹å¤´çš„è¾“å‡ºã€‚

5. **Detect_LSCD**ï¼šè¿™æ˜¯ä¸€ä¸ªè½»é‡çº§å…±äº«å·ç§¯æ£€æµ‹å¤´ï¼Œä½¿ç”¨å…±äº«å·ç§¯å±‚æ¥å‡å°‘å‚æ•°æ•°é‡å’Œè®¡ç®—é‡ã€‚å®ƒçš„è®¾è®¡æ€æƒ³æ˜¯é€šè¿‡å…±äº«å·ç§¯å±‚æ¥æé«˜æ¨¡å‹çš„æ•ˆç‡ã€‚

6. **Detect_TADDH**ï¼šè¿™æ˜¯ä¸€ä¸ªä»»åŠ¡åŠ¨æ€å¯¹é½æ£€æµ‹å¤´ï¼Œç»“åˆäº†ä»»åŠ¡åˆ†è§£å’ŒåŠ¨æ€å·ç§¯çš„æ€æƒ³ï¼Œä»¥æé«˜æ£€æµ‹ç²¾åº¦å’Œé€Ÿåº¦ã€‚

7. **Detect_NMSFree**ï¼šè¿™æ˜¯ä¸€ä¸ªæ— éæå¤§å€¼æŠ‘åˆ¶ï¼ˆNMSï¼‰çš„æ£€æµ‹å¤´ï¼Œæ—¨åœ¨å¤„ç†å¤šä¸ªæ£€æµ‹ç»“æœï¼Œé¿å…ä¼ ç»Ÿ NMS å¸¦æ¥çš„ä¿¡æ¯æŸå¤±ã€‚

æ¯ä¸ªæ£€æµ‹å¤´ç±»éƒ½å®ç°äº† `forward` æ–¹æ³•ï¼Œè´Ÿè´£å®šä¹‰å‰å‘ä¼ æ’­çš„é€»è¾‘ã€‚åœ¨å‰å‘ä¼ æ’­ä¸­ï¼Œè¾“å…¥ç‰¹å¾ç»è¿‡ä¸€ç³»åˆ—å·ç§¯å’Œæ¿€æ´»å‡½æ•°å¤„ç†ï¼Œæœ€ç»ˆè¾“å‡ºè¾¹ç•Œæ¡†å’Œç±»åˆ«æ¦‚ç‡ã€‚æ–‡ä»¶ä¸­è¿˜åŒ…å«äº†å¯¹è¾¹ç•Œæ¡†çš„è§£ç é€»è¾‘ï¼Œä»¥ä¾¿å°†æ¨¡å‹è¾“å‡ºè½¬æ¢ä¸ºå®é™…çš„æ£€æµ‹ç»“æœã€‚

æ­¤å¤–ï¼Œæ–‡ä»¶ä¸­è¿˜å®šä¹‰äº†ä¸€äº›è¾…åŠ©ç±»å’Œå‡½æ•°ï¼Œä¾‹å¦‚ `Scale` å’Œ `Conv_GN`ï¼Œç”¨äºå®ç°å¯å­¦ä¹ çš„ç¼©æ”¾å‚æ•°å’Œæ ‡å‡†å·ç§¯å±‚ï¼Œåˆ†åˆ«å¢å¼ºäº†æ¨¡å‹çš„çµæ´»æ€§å’Œæ€§èƒ½ã€‚

æ€»ä½“è€Œè¨€ï¼Œ`head.py` æ–‡ä»¶å®ç°äº† YOLOv8 çš„å¤šä¸ªæ£€æµ‹å¤´ï¼Œæä¾›äº†çµæ´»çš„ç»“æ„ä»¥é€‚åº”ä¸åŒçš„ç›®æ ‡æ£€æµ‹ä»»åŠ¡ï¼Œç»“åˆäº†åŠ¨æ€è°ƒæ•´ã€ç‰¹å¾é‡‘å­—å¡”ã€è½»é‡çº§è®¾è®¡ç­‰å¤šç§ç°ä»£æ·±åº¦å­¦ä¹ æŠ€æœ¯ã€‚

#### 10.2 CTrans.py

ä»¥ä¸‹æ˜¯ç»è¿‡ç®€åŒ–å’Œæ³¨é‡Šçš„æ ¸å¿ƒä»£ç éƒ¨åˆ†ï¼Œä¸»è¦åŒ…æ‹¬ `ChannelTransformer` ç±»åŠå…¶ç›¸å…³çš„åµŒå…¥ã€é‡æ„å’Œç¼–ç æ¨¡å—ã€‚

```python
import torch
import torch.nn as nn
import numpy as np
from torch.nn import Dropout, LayerNorm

class Channel_Embeddings(nn.Module):
    """æ„å»ºé€šé“åµŒå…¥ï¼ŒåŒ…æ‹¬è¡¥ä¸åµŒå…¥å’Œä½ç½®åµŒå…¥ã€‚"""
    def __init__(self, patchsize, img_size, in_channels):
        super().__init__()
        img_size = (img_size, img_size)  # å°†å›¾åƒå¤§å°è½¬æ¢ä¸ºå…ƒç»„
        patch_size = (patchsize, patchsize)  # å°†è¡¥ä¸å¤§å°è½¬æ¢ä¸ºå…ƒç»„
        n_patches = (img_size[0] // patch_size[0]) * (img_size[1] // patch_size[1])  # è®¡ç®—è¡¥ä¸æ•°é‡

        # å®šä¹‰è¡¥ä¸åµŒå…¥å±‚
        self.patch_embeddings = nn.Sequential(
            nn.MaxPool2d(kernel_size=5, stride=5),  # æœ€å¤§æ± åŒ–å±‚
            nn.Conv2d(in_channels=in_channels,
                      out_channels=in_channels,
                      kernel_size=patchsize // 5,
                      stride=patchsize // 5)  # å·ç§¯å±‚
        )

        # å®šä¹‰ä½ç½®åµŒå…¥å‚æ•°
        self.position_embeddings = nn.Parameter(torch.zeros(1, n_patches, in_channels))
        self.dropout = Dropout(0.1)  # Dropoutå±‚ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆ

    def forward(self, x):
        """å‰å‘ä¼ æ’­ï¼Œè®¡ç®—åµŒå…¥ã€‚"""
        if x is None:
            return None
        x = self.patch_embeddings(x)  # é€šè¿‡è¡¥ä¸åµŒå…¥å±‚
        x = x.flatten(2)  # å±•å¹³
        x = x.transpose(-1, -2)  # è½¬ç½®
        embeddings = x + self.position_embeddings  # åŠ ä¸Šä½ç½®åµŒå…¥
        embeddings = self.dropout(embeddings)  # åº”ç”¨Dropout
        return embeddings

class Reconstruct(nn.Module):
    """é‡æ„æ¨¡å—ï¼Œç”¨äºå°†åµŒå…¥é‡æ„ä¸ºå›¾åƒã€‚"""
    def __init__(self, in_channels, out_channels, kernel_size, scale_factor):
        super(Reconstruct, self).__init__()
        padding = 1 if kernel_size == 3 else 0  # æ ¹æ®å·ç§¯æ ¸å¤§å°è®¾ç½®å¡«å……
        self.conv = nn.Conv2d(in_channels, out_channels, kernel_size=kernel_size, padding=padding)  # å·ç§¯å±‚
        self.norm = nn.BatchNorm2d(out_channels)  # æ‰¹å½’ä¸€åŒ–å±‚
        self.activation = nn.ReLU(inplace=True)  # æ¿€æ´»å‡½æ•°
        self.scale_factor = scale_factor  # ç¼©æ”¾å› å­

    def forward(self, x):
        """å‰å‘ä¼ æ’­ï¼Œè¿›è¡Œé‡æ„ã€‚"""
        if x is None:
            return None

        B, n_patch, hidden = x.size()  # è·å–è¾“å…¥çš„å½¢çŠ¶
        h, w = int(np.sqrt(n_patch)), int(np.sqrt(n_patch))  # è®¡ç®—é«˜åº¦å’Œå®½åº¦
        x = x.permute(0, 2, 1)  # å˜æ¢ç»´åº¦
        x = x.contiguous().view(B, hidden, h, w)  # é‡æ–°å½¢çŠ¶
        x = nn.Upsample(scale_factor=self.scale_factor)(x)  # ä¸Šé‡‡æ ·

        out = self.conv(x)  # å·ç§¯æ“ä½œ
        out = self.norm(out)  # å½’ä¸€åŒ–
        out = self.activation(out)  # æ¿€æ´»
        return out

class Encoder(nn.Module):
    """ç¼–ç å™¨æ¨¡å—ï¼ŒåŒ…å«å¤šä¸ªå—ã€‚"""
    def __init__(self, vis, channel_num):
        super(Encoder, self).__init__()
        self.layer = nn.ModuleList()  # å­˜å‚¨å¤šä¸ªç¼–ç å—
        for _ in range(1):  # è¿™é‡Œå¯ä»¥è°ƒæ•´ç¼–ç å—çš„æ•°é‡
            layer = Block_ViT(vis, channel_num)  # åˆ›å»ºç¼–ç å—
            self.layer.append(layer)

    def forward(self, emb1, emb2, emb3, emb4):
        """å‰å‘ä¼ æ’­ï¼Œç»è¿‡æ‰€æœ‰ç¼–ç å—ã€‚"""
        for layer_block in self.layer:
            emb1, emb2, emb3, emb4, weights = layer_block(emb1, emb2, emb3, emb4)  # é€šè¿‡æ¯ä¸ªç¼–ç å—
        return emb1, emb2, emb3, emb4  # è¿”å›ç¼–ç åçš„åµŒå…¥

class ChannelTransformer(nn.Module):
    """é€šé“å˜æ¢å™¨ï¼Œæ•´åˆåµŒå…¥ã€ç¼–ç å’Œé‡æ„æ¨¡å—ã€‚"""
    def __init__(self, channel_num=[64, 128, 256, 512], img_size=640, vis=False, patchSize=[40, 20, 10, 5]):
        super().__init__()
        # åˆå§‹åŒ–åµŒå…¥å±‚
        self.embeddings_1 = Channel_Embeddings(patchSize[0], img_size // 8, channel_num[0])
        self.embeddings_2 = Channel_Embeddings(patchSize[1], img_size // 16, channel_num[1])
        self.embeddings_3 = Channel_Embeddings(patchSize[2], img_size // 32, channel_num[2])
        self.embeddings_4 = Channel_Embeddings(patchSize[3], img_size // 64, channel_num[3]) if len(channel_num) == 4 else nn.Identity()
        
        self.encoder = Encoder(vis, channel_num)  # åˆå§‹åŒ–ç¼–ç å™¨

        # åˆå§‹åŒ–é‡æ„å±‚
        self.reconstruct_1 = Reconstruct(channel_num[0], channel_num[0], kernel_size=1, scale_factor=(patchSize[0], patchSize[0]))
        self.reconstruct_2 = Reconstruct(channel_num[1], channel_num[1], kernel_size=1, scale_factor=(patchSize[1], patchSize[1]))
        self.reconstruct_3 = Reconstruct(channel_num[2], channel_num[2], kernel_size=1, scale_factor=(patchSize[2], patchSize[2]))
        self.reconstruct_4 = Reconstruct(channel_num[3], channel_num[3], kernel_size=1, scale_factor=(patchSize[3], patchSize[3])) if len(channel_num) == 4 else nn.Identity()

    def forward(self, en):
        """å‰å‘ä¼ æ’­ï¼Œå¤„ç†è¾“å…¥å¹¶è¿”å›é‡æ„ç»“æœã€‚"""
        en1, en2, en3, en4 = en if len(en) == 4 else (en[0], en[1], en[2], None)
        
        # è®¡ç®—åµŒå…¥
        emb1 = self.embeddings_1(en1) if en1 is not None else None
        emb2 = self.embeddings_2(en2) if en2 is not None else None
        emb3 = self.embeddings_3(en3) if en3 is not None else None
        emb4 = self.embeddings_4(en4) if en4 is not None else None

        # ç¼–ç 
        encoded1, encoded2, encoded3, encoded4 = self.encoder(emb1, emb2, emb3, emb4)

        # é‡æ„
        x1 = self.reconstruct_1(encoded1) + en1 if en1 is not None else None
        x2 = self.reconstruct_2(encoded2) + en2 if en2 is not None else None
        x3 = self.reconstruct_3(encoded3) + en3 if en3 is not None else None
        x4 = self.reconstruct_4(encoded4) + en4 if en4 is not None else None

        return [x1, x2, x3, x4]  # è¿”å›é‡æ„åçš„ç»“æœ
```

### ä»£ç è¯´æ˜
1. **Channel_Embeddings**: è´Ÿè´£å°†è¾“å…¥å›¾åƒåˆ†å‰²æˆè¡¥ä¸å¹¶ç”Ÿæˆç›¸åº”çš„åµŒå…¥ï¼ŒåŒ…æ‹¬ä½ç½®åµŒå…¥ã€‚
2. **Reconstruct**: è´Ÿè´£å°†åµŒå…¥é‡æ„ä¸ºå›¾åƒçš„æ¨¡å—ï¼Œé€šè¿‡å·ç§¯å’Œä¸Šé‡‡æ ·å®ç°ã€‚
3. **Encoder**: ç”±å¤šä¸ªç¼–ç å—ç»„æˆï¼Œè´Ÿè´£å¤„ç†åµŒå…¥å¹¶æå–ç‰¹å¾ã€‚
4. **ChannelTransformer**: æ•´åˆäº†åµŒå…¥ã€ç¼–ç å’Œé‡æ„æ¨¡å—ï¼Œå¤„ç†è¾“å…¥å¹¶è¿”å›é‡æ„åçš„å›¾åƒã€‚

è¿™äº›æ¨¡å—çš„ç»„åˆä½¿å¾—æ•´ä¸ªæ¨¡å‹èƒ½å¤Ÿæœ‰æ•ˆåœ°å¤„ç†å›¾åƒæ•°æ®ï¼Œæå–ç‰¹å¾å¹¶è¿›è¡Œé‡æ„ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶ `CTrans.py` å®ç°äº†ä¸€ä¸ªåŸºäºé€šé“çš„å˜æ¢å™¨ï¼ˆChannel Transformerï¼‰ï¼Œä¸»è¦ç”¨äºå›¾åƒå¤„ç†ä»»åŠ¡ã€‚ç¨‹åºä¸­ä½¿ç”¨äº† PyTorch æ¡†æ¶ï¼ŒåŒ…å«å¤šä¸ªç±»å’Œæ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—è´Ÿè´£ä¸åŒçš„åŠŸèƒ½ã€‚

é¦–å…ˆï¼Œæ–‡ä»¶å¼•å…¥äº†ä¸€äº›å¿…è¦çš„åº“ï¼ŒåŒ…æ‹¬ `torch` å’Œ `torch.nn`ï¼Œè¿™äº›åº“æä¾›äº†æ„å»ºç¥ç»ç½‘ç»œæ‰€éœ€çš„åŸºç¡€ç»„ä»¶ã€‚æ¥ä¸‹æ¥ï¼Œå®šä¹‰äº†å‡ ä¸ªç±»ï¼Œåˆ†åˆ«å®ç°äº†ä¸åŒçš„åŠŸèƒ½ã€‚

`Channel_Embeddings` ç±»ç”¨äºæ„å»ºå›¾åƒçš„åµŒå…¥è¡¨ç¤ºã€‚å®ƒé€šè¿‡å¯¹è¾“å…¥å›¾åƒè¿›è¡Œæœ€å¤§æ± åŒ–å’Œå·ç§¯æ“ä½œï¼Œå°†å›¾åƒåˆ’åˆ†ä¸ºå¤šä¸ªè¡¥ä¸ï¼Œå¹¶ä¸ºæ¯ä¸ªè¡¥ä¸ç”Ÿæˆä½ç½®åµŒå…¥ã€‚ä½ç½®åµŒå…¥æ˜¯é€šè¿‡ä¸€ä¸ªå¯å­¦ä¹ çš„å‚æ•°ç”Ÿæˆçš„ï¼Œå¹¶åœ¨å‰å‘ä¼ æ’­ä¸­ä¸è¡¥ä¸åµŒå…¥ç›¸åŠ ï¼Œæœ€åé€šè¿‡ dropout å±‚è¿›è¡Œæ­£åˆ™åŒ–ã€‚

`Reconstruct` ç±»ç”¨äºé‡å»ºç‰¹å¾å›¾ã€‚å®ƒæ¥å—åµŒå…¥ç‰¹å¾å¹¶é€šè¿‡å·ç§¯å±‚å’Œæ‰¹å½’ä¸€åŒ–å±‚è¿›è¡Œå¤„ç†ï¼ŒåŒæ—¶ä½¿ç”¨ä¸Šé‡‡æ ·æ¥æ¢å¤ç‰¹å¾å›¾çš„ç©ºé—´åˆ†è¾¨ç‡ã€‚

`Attention_org` ç±»å®ç°äº†å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶ã€‚å®ƒå°†è¾“å…¥çš„åµŒå…¥ç‰¹å¾åˆ†ä¸ºå¤šä¸ªå¤´ï¼Œå¹¶è®¡ç®—æ¯ä¸ªå¤´çš„æŸ¥è¯¢ã€é”®å’Œå€¼ã€‚é€šè¿‡è®¡ç®—æ³¨æ„åŠ›åˆ†æ•°å¹¶åº”ç”¨ softmax å‡½æ•°ï¼Œå¾—åˆ°æ³¨æ„åŠ›æƒé‡ï¼Œæœ€ç»ˆç”Ÿæˆä¸Šä¸‹æ–‡å±‚è¾“å‡ºã€‚è¯¥ç±»è¿˜æ”¯æŒå¯è§†åŒ–æ³¨æ„åŠ›æƒé‡ã€‚

`Mlp` ç±»å®ç°äº†ä¸€ä¸ªç®€å•çš„å¤šå±‚æ„ŸçŸ¥æœºï¼ˆMLPï¼‰ï¼ŒåŒ…å«ä¸¤ä¸ªå…¨è¿æ¥å±‚å’Œä¸€ä¸ªæ¿€æ´»å‡½æ•°ï¼ˆGELUï¼‰ã€‚å®ƒç”¨äºç‰¹å¾çš„éçº¿æ€§å˜æ¢ã€‚

`Block_ViT` ç±»æ˜¯ä¸€ä¸ªå˜æ¢å™¨å—ï¼ŒåŒ…å«æ³¨æ„åŠ›å±‚å’Œå‰é¦ˆç½‘ç»œã€‚å®ƒé¦–å…ˆå¯¹è¾“å…¥çš„åµŒå…¥è¿›è¡Œå±‚å½’ä¸€åŒ–ï¼Œç„¶åé€šè¿‡æ³¨æ„åŠ›æœºåˆ¶å’Œå‰é¦ˆç½‘ç»œè¿›è¡Œå¤„ç†ï¼Œæœ€åå°†ç»“æœä¸è¾“å…¥è¿›è¡Œæ®‹å·®è¿æ¥ã€‚

`Encoder` ç±»åŒ…å«å¤šä¸ª `Block_ViT` å±‚ï¼Œè´Ÿè´£å¯¹è¾“å…¥çš„åµŒå…¥è¿›è¡Œç¼–ç ã€‚å®ƒå°†åµŒå…¥é€šè¿‡å¤šä¸ªå˜æ¢å™¨å—è¿›è¡Œå¤„ç†ï¼Œå¹¶è¿”å›ç¼–ç åçš„ç‰¹å¾ã€‚

`ChannelTransformer` ç±»æ˜¯æ•´ä¸ªæ¨¡å‹çš„æ ¸å¿ƒã€‚å®ƒåˆå§‹åŒ–äº†å¤šä¸ªåµŒå…¥å±‚ã€ç¼–ç å™¨å’Œé‡å»ºå±‚ã€‚å‰å‘ä¼ æ’­è¿‡ç¨‹ä¸­ï¼Œè¾“å…¥çš„ç‰¹å¾ç»è¿‡åµŒå…¥å±‚ã€ç¼–ç å™¨å¤„ç†åï¼Œå†é€šè¿‡é‡å»ºå±‚æ¢å¤åˆ°åŸå§‹çš„ç©ºé—´åˆ†è¾¨ç‡ï¼Œå¹¶ä¸è¾“å…¥ç‰¹å¾è¿›è¡Œç›¸åŠ ï¼Œå½¢æˆæœ€ç»ˆçš„è¾“å‡ºã€‚

æœ€åï¼Œ`GetIndexOutput` ç±»ç”¨äºä»æ¨¡å‹çš„è¾“å‡ºä¸­æå–ç‰¹å®šç´¢å¼•çš„ç»“æœã€‚

æ€»ä½“è€Œè¨€ï¼Œè¿™ä¸ªç¨‹åºå®ç°äº†ä¸€ä¸ªå¤æ‚çš„é€šé“å˜æ¢å™¨ç»“æ„ï¼Œç»“åˆäº†å·ç§¯ã€æ³¨æ„åŠ›æœºåˆ¶å’Œå¤šå±‚æ„ŸçŸ¥æœºï¼Œé€‚ç”¨äºå›¾åƒå¤„ç†å’Œç‰¹å¾æå–ä»»åŠ¡ã€‚

#### 10.3 afpn.py

ä»¥ä¸‹æ˜¯ä¿ç•™çš„æ ¸å¿ƒä»£ç éƒ¨åˆ†ï¼Œå¹¶é™„ä¸Šè¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

```python
import torch
import torch.nn as nn
import torch.nn.functional as F
from ..modules.conv import Conv

class BasicBlock(nn.Module):
    """åŸºæœ¬çš„å·ç§¯å—ï¼ŒåŒ…å«ä¸¤ä¸ªå·ç§¯å±‚å’Œæ®‹å·®è¿æ¥"""
    def __init__(self, filter_in, filter_out):
        super(BasicBlock, self).__init__()
        # ç¬¬ä¸€ä¸ªå·ç§¯å±‚ï¼Œä½¿ç”¨3x3å·ç§¯
        self.conv1 = Conv(filter_in, filter_out, 3)
        # ç¬¬äºŒä¸ªå·ç§¯å±‚ï¼Œä½¿ç”¨3x3å·ç§¯ï¼Œä¸ä½¿ç”¨æ¿€æ´»å‡½æ•°
        self.conv2 = Conv(filter_out, filter_out, 3, act=False)

    def forward(self, x):
        residual = x  # ä¿å­˜è¾“å…¥ä»¥ç”¨äºæ®‹å·®è¿æ¥
        out = self.conv1(x)  # é€šè¿‡ç¬¬ä¸€ä¸ªå·ç§¯å±‚
        out = self.conv2(out)  # é€šè¿‡ç¬¬äºŒä¸ªå·ç§¯å±‚
        out += residual  # æ·»åŠ æ®‹å·®
        return self.conv1.act(out)  # é€šè¿‡æ¿€æ´»å‡½æ•°å¹¶è¿”å›

class Upsample(nn.Module):
    """ä¸Šé‡‡æ ·æ¨¡å—ï¼Œä½¿ç”¨1x1å·ç§¯å’ŒåŒçº¿æ€§æ’å€¼"""
    def __init__(self, in_channels, out_channels, scale_factor=2):
        super(Upsample, self).__init__()
        self.upsample = nn.Sequential(
            Conv(in_channels, out_channels, 1),  # 1x1å·ç§¯
            nn.Upsample(scale_factor=scale_factor, mode='bilinear')  # åŒçº¿æ€§æ’å€¼ä¸Šé‡‡æ ·
        )

    def forward(self, x):
        return self.upsample(x)  # è¿”å›ä¸Šé‡‡æ ·åçš„ç»“æœ

class Downsample_x2(nn.Module):
    """ä¸‹é‡‡æ ·æ¨¡å—ï¼Œä½¿ç”¨2x2å·ç§¯"""
    def __init__(self, in_channels, out_channels):
        super(Downsample_x2, self).__init__()
        self.downsample = Conv(in_channels, out_channels, 2, 2, 0)  # 2x2å·ç§¯ï¼Œæ­¥å¹…ä¸º2

    def forward(self, x):
        return self.downsample(x)  # è¿”å›ä¸‹é‡‡æ ·åçš„ç»“æœ

class ASFF_2(nn.Module):
    """è‡ªé€‚åº”ç‰¹å¾èåˆæ¨¡å—ï¼Œèåˆä¸¤ä¸ªè¾“å…¥ç‰¹å¾å›¾"""
    def __init__(self, inter_dim=512):
        super(ASFF_2, self).__init__()
        self.inter_dim = inter_dim
        compress_c = 8  # å‹ç¼©é€šé“æ•°

        # ä¸ºæ¯ä¸ªè¾“å…¥ç‰¹å¾å›¾ç”Ÿæˆæƒé‡
        self.weight_level_1 = Conv(self.inter_dim, compress_c, 1)
        self.weight_level_2 = Conv(self.inter_dim, compress_c, 1)
        self.weight_levels = nn.Conv2d(compress_c * 2, 2, kernel_size=1, stride=1, padding=0)  # æƒé‡èåˆ
        self.conv = Conv(self.inter_dim, self.inter_dim, 3)  # æœ€åçš„å·ç§¯å±‚

    def forward(self, input1, input2):
        # è®¡ç®—æ¯ä¸ªè¾“å…¥çš„æƒé‡
        level_1_weight_v = self.weight_level_1(input1)
        level_2_weight_v = self.weight_level_2(input2)

        # åˆå¹¶æƒé‡å¹¶è®¡ç®—æœ€ç»ˆæƒé‡
        levels_weight_v = torch.cat((level_1_weight_v, level_2_weight_v), 1)
        levels_weight = self.weight_levels(levels_weight_v)
        levels_weight = F.softmax(levels_weight, dim=1)  # å½’ä¸€åŒ–æƒé‡

        # æ ¹æ®æƒé‡èåˆè¾“å…¥ç‰¹å¾å›¾
        fused_out_reduced = input1 * levels_weight[:, 0:1, :, :] + input2 * levels_weight[:, 1:2, :, :]
        out = self.conv(fused_out_reduced)  # é€šè¿‡å·ç§¯å±‚
        return out  # è¿”å›èåˆåçš„ç»“æœ

class BlockBody_P345(nn.Module):
    """ç‰¹å¾å—ä½“ï¼Œå¤„ç†3ä¸ªå°ºåº¦çš„ç‰¹å¾å›¾"""
    def __init__(self, channels=[64, 128, 256, 512]):
        super(BlockBody_P345, self).__init__()
        # åˆå§‹åŒ–ä¸åŒå°ºåº¦çš„å·ç§¯å—å’Œä¸‹é‡‡æ ·ã€ä¸Šé‡‡æ ·æ¨¡å—
        self.blocks_scalezero1 = nn.Sequential(Conv(channels[0], channels[0], 1))
        self.blocks_scaleone1 = nn.Sequential(Conv(channels[1], channels[1], 1))
        self.blocks_scaletwo1 = nn.Sequential(Conv(channels[2], channels[2], 1))

        self.downsample_scalezero1_2 = Downsample_x2(channels[0], channels[1])
        self.upsample_scaleone1_2 = Upsample(channels[1], channels[0], scale_factor=2)

        self.asff_scalezero1 = ASFF_2(inter_dim=channels[0])
        self.asff_scaleone1 = ASFF_2(inter_dim=channels[1])

    def forward(self, x):
        x0, x1, x2 = x  # åˆ†åˆ«è·å–ä¸‰ä¸ªå°ºåº¦çš„ç‰¹å¾å›¾

        # å¤„ç†æ¯ä¸ªå°ºåº¦çš„ç‰¹å¾å›¾
        x0 = self.blocks_scalezero1(x0)
        x1 = self.blocks_scaleone1(x1)
        x2 = self.blocks_scaletwo1(x2)

        # èåˆä¸åŒå°ºåº¦çš„ç‰¹å¾å›¾
        scalezero = self.asff_scalezero1(x0, self.upsample_scaleone1_2(x1))
        scaleone = self.asff_scaleone1(self.downsample_scalezero1_2(x0), x1)

        return scalezero, scaleone  # è¿”å›èåˆåçš„ç‰¹å¾å›¾

class AFPN_P345(nn.Module):
    """è‡ªé€‚åº”ç‰¹å¾é‡‘å­—å¡”ç½‘ç»œï¼Œå¤„ç†3ä¸ªå°ºåº¦çš„è¾“å…¥ç‰¹å¾å›¾"""
    def __init__(self, in_channels=[256, 512, 1024], out_channels=256, factor=4):
        super(AFPN_P345, self).__init__()
        # åˆå§‹åŒ–è¾“å…¥ç‰¹å¾å›¾çš„å·ç§¯å±‚
        self.conv0 = Conv(in_channels[0], in_channels[0] // factor, 1)
        self.conv1 = Conv(in_channels[1], in_channels[1] // factor, 1)
        self.conv2 = Conv(in_channels[2], in_channels[2] // factor, 1)

        self.body = BlockBody_P345([in_channels[0] // factor, in_channels[1] // factor, in_channels[2] // factor])

        # åˆå§‹åŒ–è¾“å‡ºç‰¹å¾å›¾çš„å·ç§¯å±‚
        self.conv00 = Conv(in_channels[0] // factor, out_channels, 1)
        self.conv11 = Conv(in_channels[1] // factor, out_channels, 1)
        self.conv22 = Conv(in_channels[2] // factor, out_channels, 1)

    def forward(self, x):
        x0, x1, x2 = x  # è·å–è¾“å…¥ç‰¹å¾å›¾

        # é€šè¿‡å·ç§¯å±‚å¤„ç†è¾“å…¥ç‰¹å¾å›¾
        x0 = self.conv0(x0)
        x1 = self.conv1(x1)
        x2 = self.conv2(x2)

        # é€šè¿‡ç‰¹å¾å—ä½“å¤„ç†ç‰¹å¾å›¾
        out0, out1, out2 = self.body([x0, x1, x2])

        # é€šè¿‡è¾“å‡ºå·ç§¯å±‚å¤„ç†ç‰¹å¾å›¾
        out0 = self.conv00(out0)
        out1 = self.conv11(out1)
        out2 = self.conv22(out2)
        return [out0, out1, out2]  # è¿”å›è¾“å‡ºç‰¹å¾å›¾
```

### ä»£ç è¯´æ˜ï¼š
1. **BasicBlock**ï¼šå®ç°äº†ä¸€ä¸ªåŸºæœ¬çš„å·ç§¯å—ï¼ŒåŒ…å«ä¸¤ä¸ªå·ç§¯å±‚å’Œæ®‹å·®è¿æ¥ï¼Œèƒ½å¤Ÿå¸®åŠ©æ¨¡å‹å­¦ä¹ æ›´æ·±å±‚æ¬¡çš„ç‰¹å¾ã€‚
2. **Upsample** å’Œ **Downsample**ï¼šåˆ†åˆ«å®ç°äº†ä¸Šé‡‡æ ·å’Œä¸‹é‡‡æ ·åŠŸèƒ½ï¼Œç”¨äºè°ƒæ•´ç‰¹å¾å›¾çš„å°ºå¯¸ã€‚
3. **ASFF_2**ï¼šå®ç°äº†è‡ªé€‚åº”ç‰¹å¾èåˆæ¨¡å—ï¼Œèƒ½å¤Ÿæ ¹æ®è¾“å…¥ç‰¹å¾å›¾çš„æƒé‡åŠ¨æ€èåˆç‰¹å¾ã€‚
4. **BlockBody_P345**ï¼šå®ç°äº†å¤„ç†ä¸‰ä¸ªå°ºåº¦ç‰¹å¾å›¾çš„æ¨¡å—ï¼Œä½¿ç”¨äº†å¤šä¸ªå·ç§¯å—å’Œèåˆæ¨¡å—ã€‚
5. **AFPN_P345**ï¼šæ„å»ºäº†è‡ªé€‚åº”ç‰¹å¾é‡‘å­—å¡”ç½‘ç»œçš„ä¸»ä½“ï¼Œè´Ÿè´£è¾“å…¥ç‰¹å¾å›¾çš„å¤„ç†å’Œè¾“å‡ºç‰¹å¾å›¾çš„ç”Ÿæˆã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶`afpn.py`å®ç°äº†ä¸€ä¸ªç”¨äºå›¾åƒå¤„ç†çš„æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œä¸»è¦ç”¨äºç‰¹å¾é‡‘å­—å¡”ç½‘ç»œï¼ˆFPNï¼‰çš„æ„å»ºã€‚è¯¥æ¨¡å‹ç”±å¤šä¸ªç±»ç»„æˆï¼Œæ¯ä¸ªç±»è´Ÿè´£ä¸åŒçš„åŠŸèƒ½æ¨¡å—ï¼Œä¸‹é¢å¯¹è¿™äº›ç±»åŠå…¶åŠŸèƒ½è¿›è¡Œè¯¦ç»†è¯´æ˜ã€‚

é¦–å…ˆï¼Œç¨‹åºå¯¼å…¥äº†ä¸€äº›å¿…è¦çš„åº“ï¼ŒåŒ…æ‹¬`torch`å’Œ`torch.nn`ï¼Œä»¥åŠä¸€äº›è‡ªå®šä¹‰çš„æ¨¡å—å¦‚`Conv`å’Œä¸åŒçš„å—ï¼ˆblockï¼‰ã€‚è¿™äº›æ¨¡å—æä¾›äº†å·ç§¯æ“ä½œå’Œç‰¹å®šçš„ç½‘ç»œç»“æ„ã€‚

`BasicBlock`ç±»å®šä¹‰äº†ä¸€ä¸ªåŸºæœ¬çš„æ®‹å·®å—ï¼Œå®ƒåŒ…å«ä¸¤ä¸ªå·ç§¯å±‚å’Œä¸€ä¸ªè·³è·ƒè¿æ¥ã€‚è¿™ä¸ªç»“æ„å¯ä»¥å¸®åŠ©ç½‘ç»œå­¦ä¹ æ›´æ·±å±‚æ¬¡çš„ç‰¹å¾ï¼ŒåŒæ—¶é¿å…æ¢¯åº¦æ¶ˆå¤±çš„é—®é¢˜ã€‚

`Upsample`å’Œ`Downsample_x2`ã€`Downsample_x4`ã€`Downsample_x8`ç±»ç”¨äºå›¾åƒçš„ä¸Šé‡‡æ ·å’Œä¸‹é‡‡æ ·ï¼Œåˆ†åˆ«é€šè¿‡å·ç§¯å’Œæ’å€¼æ–¹æ³•æ”¹å˜ç‰¹å¾å›¾çš„å°ºå¯¸ã€‚è¿™äº›æ“ä½œåœ¨ç‰¹å¾é‡‘å­—å¡”ç½‘ç»œä¸­æ˜¯éå¸¸é‡è¦çš„ï¼Œå› ä¸ºå®ƒä»¬å…è®¸æ¨¡å‹åœ¨ä¸åŒçš„å°ºåº¦ä¸Šå¤„ç†ç‰¹å¾ã€‚

`ASFF_2`ã€`ASFF_3`å’Œ`ASFF_4`ç±»å®ç°äº†è‡ªé€‚åº”ç‰¹å¾èåˆæ¨¡å—ï¼ˆASFFï¼‰ï¼Œç”¨äºåœ¨ä¸åŒå±‚æ¬¡çš„ç‰¹å¾ä¹‹é—´è¿›è¡ŒåŠ æƒèåˆã€‚æ¯ä¸ªç±»æ ¹æ®è¾“å…¥çš„ç‰¹å¾å›¾æ•°é‡ï¼ˆ2ã€3æˆ–4ï¼‰æ¥è®¡ç®—æƒé‡ï¼Œå¹¶å°†ä¸åŒå±‚æ¬¡çš„ç‰¹å¾è¿›è¡Œèåˆï¼Œä»¥ä¾¿æ›´å¥½åœ°æ•æ‰å¤šå°ºåº¦ä¿¡æ¯ã€‚

`BlockBody_P345`å’Œ`BlockBody_P2345`ç±»æ„å»ºäº†ç½‘ç»œçš„ä¸»ä½“ç»“æ„ï¼Œåˆ†åˆ«å¤„ç†3ä¸ªå’Œ4ä¸ªå°ºåº¦çš„ç‰¹å¾å›¾ã€‚è¿™äº›ç±»ä¸­ä½¿ç”¨äº†å¤šä¸ªåŸºæœ¬å—å’Œè‡ªé€‚åº”ç‰¹å¾èåˆæ¨¡å—ï¼Œæ„æˆäº†å¤æ‚çš„ç‰¹å¾æå–å’Œèåˆè¿‡ç¨‹ã€‚æ¯ä¸ªå°ºåº¦çš„ç‰¹å¾å›¾ç»è¿‡å·ç§¯ã€ä¸‹é‡‡æ ·ã€ä¸Šé‡‡æ ·å’Œèåˆæ“ä½œï¼Œæœ€ç»ˆç”Ÿæˆæ›´ä¸°å¯Œçš„ç‰¹å¾è¡¨ç¤ºã€‚

`AFPN_P345`å’Œ`AFPN_P2345`ç±»æ˜¯ç‰¹å¾é‡‘å­—å¡”ç½‘ç»œçš„å…·ä½“å®ç°ï¼Œè´Ÿè´£æ¥æ”¶è¾“å…¥ç‰¹å¾å›¾å¹¶é€šè¿‡ä¸€ç³»åˆ—å·ç§¯å’Œå—ä½“è¿›è¡Œå¤„ç†ï¼Œè¾“å‡ºç»è¿‡å¤„ç†çš„ç‰¹å¾å›¾ã€‚å®ƒä»¬è¿˜åŒ…å«äº†æƒé‡åˆå§‹åŒ–çš„é€»è¾‘ï¼Œä»¥ç¡®ä¿ç½‘ç»œåœ¨è®­ç»ƒå¼€å§‹æ—¶å…·æœ‰è‰¯å¥½çš„æ€§èƒ½ã€‚

`BlockBody_P345_Custom`å’Œ`BlockBody_P2345_Custom`ç±»å…è®¸ç”¨æˆ·è‡ªå®šä¹‰å—çš„ç±»å‹ï¼Œä½¿å¾—æ¨¡å‹æ›´åŠ çµæ´»ï¼Œèƒ½å¤Ÿé€‚åº”ä¸åŒçš„ä»»åŠ¡éœ€æ±‚ã€‚

æ•´ä½“æ¥çœ‹ï¼Œè¿™ä¸ªç¨‹åºæ–‡ä»¶å®ç°äº†ä¸€ä¸ªå¤æ‚çš„æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œä¸“æ³¨äºç‰¹å¾æå–å’Œèåˆï¼Œé€‚ç”¨äºéœ€è¦å¤šå°ºåº¦ç‰¹å¾çš„ä»»åŠ¡ï¼Œå¦‚ç›®æ ‡æ£€æµ‹å’Œå›¾åƒåˆ†å‰²ã€‚é€šè¿‡ä½¿ç”¨æ®‹å·®è¿æ¥å’Œè‡ªé€‚åº”ç‰¹å¾èåˆï¼Œæ¨¡å‹èƒ½å¤Ÿæœ‰æ•ˆåœ°å­¦ä¹ åˆ°ä¸°å¯Œçš„ç‰¹å¾è¡¨ç¤ºã€‚

#### 10.4 attention.py

ä»¥ä¸‹æ˜¯ä¿ç•™çš„æ ¸å¿ƒä»£ç éƒ¨åˆ†ï¼Œå¹¶é™„ä¸Šè¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

```python
import torch
from torch import nn

class EMA(nn.Module):
    def __init__(self, channels, factor=8):
        super(EMA, self).__init__()
        self.groups = factor  # åˆ†ç»„æ•°
        assert channels // self.groups > 0  # ç¡®ä¿æ¯ç»„çš„é€šé“æ•°å¤§äº0
        self.softmax = nn.Softmax(-1)  # åœ¨æœ€åä¸€ä¸ªç»´åº¦ä¸Šåº”ç”¨softmax
        self.agp = nn.AdaptiveAvgPool2d((1, 1))  # è‡ªé€‚åº”å¹³å‡æ± åŒ–åˆ°1x1
        self.pool_h = nn.AdaptiveAvgPool2d((None, 1))  # è‡ªé€‚åº”å¹³å‡æ± åŒ–åˆ°hç»´
        self.pool_w = nn.AdaptiveAvgPool2d((1, None))  # è‡ªé€‚åº”å¹³å‡æ± åŒ–åˆ°wç»´
        self.gn = nn.GroupNorm(channels // self.groups, channels // self.groups)  # åˆ†ç»„å½’ä¸€åŒ–
        self.conv1x1 = nn.Conv2d(channels // self.groups, channels // self.groups, kernel_size=1)  # 1x1å·ç§¯
        self.conv3x3 = nn.Conv2d(channels // self.groups, channels // self.groups, kernel_size=3, padding=1)  # 3x3å·ç§¯

    def forward(self, x):
        b, c, h, w = x.size()  # è·å–è¾“å…¥çš„batch size, é€šé“æ•°, é«˜, å®½
        group_x = x.reshape(b * self.groups, -1, h, w)  # å°†è¾“å…¥é‡å¡‘ä¸ºåˆ†ç»„å½¢å¼
        x_h = self.pool_h(group_x)  # å¯¹æ¯ç»„è¿›è¡Œhç»´æ± åŒ–
        x_w = self.pool_w(group_x).permute(0, 1, 3, 2)  # å¯¹æ¯ç»„è¿›è¡Œwç»´æ± åŒ–å¹¶è½¬ç½®
        hw = self.conv1x1(torch.cat([x_h, x_w], dim=2))  # å°†hå’Œwçš„æ± åŒ–ç»“æœæ‹¼æ¥åé€šè¿‡1x1å·ç§¯
        x_h, x_w = torch.split(hw, [h, w], dim=2)  # å°†ç»“æœåˆ†ä¸ºhå’Œwçš„éƒ¨åˆ†
        x1 = self.gn(group_x * x_h.sigmoid() * x_w.permute(0, 1, 3, 2).sigmoid())  # é€šè¿‡sigmoidæ¿€æ´»å‡½æ•°è¿›è¡ŒåŠ æƒ
        x2 = self.conv3x3(group_x)  # é€šè¿‡3x3å·ç§¯å¤„ç†group_x
        x11 = self.softmax(self.agp(x1).reshape(b * self.groups, -1, 1).permute(0, 2, 1))  # å¯¹x1è¿›è¡Œè‡ªé€‚åº”å¹³å‡æ± åŒ–å¹¶åº”ç”¨softmax
        x12 = x2.reshape(b * self.groups, c // self.groups, -1)  # é‡å¡‘x2
        x21 = self.softmax(self.agp(x2).reshape(b * self.groups, -1, 1).permute(0, 2, 1))  # å¯¹x2è¿›è¡Œè‡ªé€‚åº”å¹³å‡æ± åŒ–å¹¶åº”ç”¨softmax
        x22 = x1.reshape(b * self.groups, c // self.groups, -1)  # é‡å¡‘x1
        weights = (torch.matmul(x11, x12) + torch.matmul(x21, x22)).reshape(b * self.groups, 1, h, w)  # è®¡ç®—æƒé‡
        return (group_x * weights.sigmoid()).reshape(b, c, h, w)  # è¿”å›åŠ æƒåçš„ç»“æœ

class SimAM(nn.Module):
    def __init__(self, e_lambda=1e-4):
        super(SimAM, self).__init__()
        self.activaton = nn.Sigmoid()  # ä½¿ç”¨sigmoidæ¿€æ´»å‡½æ•°
        self.e_lambda = e_lambda  # æ­£åˆ™åŒ–å‚æ•°

    def forward(self, x):
        b, c, h, w = x.size()  # è·å–è¾“å…¥çš„batch size, é€šé“æ•°, é«˜, å®½
        n = w * h - 1  # è®¡ç®—n
        x_minus_mu_square = (x - x.mean(dim=[2, 3], keepdim=True)).pow(2)  # è®¡ç®—æ¯ä¸ªå…ƒç´ ä¸å‡å€¼çš„å¹³æ–¹å·®
        y = x_minus_mu_square / (4 * (x_minus_mu_square.sum(dim=[2, 3], keepdim=True) / n + self.e_lambda)) + 0.5  # è®¡ç®—y
        return x * self.activaton(y)  # è¿”å›åŠ æƒåçš„ç»“æœ

class SpatialGroupEnhance(nn.Module):
    def __init__(self, groups=8):
        super().__init__()
        self.groups = groups  # åˆ†ç»„æ•°
        self.avg_pool = nn.AdaptiveAvgPool2d(1)  # è‡ªé€‚åº”å¹³å‡æ± åŒ–åˆ°1x1
        self.weight = nn.Parameter(torch.zeros(1, groups, 1, 1))  # æƒé‡å‚æ•°
        self.bias = nn.Parameter(torch.zeros(1, groups, 1, 1))  # åç½®å‚æ•°
        self.sig = nn.Sigmoid()  # ä½¿ç”¨sigmoidæ¿€æ´»å‡½æ•°
        self.init_weights()  # åˆå§‹åŒ–æƒé‡

    def init_weights(self):
        for m in self.modules():
            if isinstance(m, nn.Conv2d):
                nn.init.kaiming_normal_(m.weight, mode='fan_out')  # ä½¿ç”¨Heåˆå§‹åŒ–å·ç§¯å±‚æƒé‡
                if m.bias is not None:
                    nn.init.constant_(m.bias, 0)  # åç½®åˆå§‹åŒ–ä¸º0
            elif isinstance(m, nn.BatchNorm2d):
                nn.init.constant_(m.weight, 1)  # æ‰¹å½’ä¸€åŒ–æƒé‡åˆå§‹åŒ–ä¸º1
                nn.init.constant_(m.bias, 0)  # åç½®åˆå§‹åŒ–ä¸º0
            elif isinstance(m, nn.Linear):
                nn.init.normal_(m.weight, std=0.001)  # çº¿æ€§å±‚æƒé‡åˆå§‹åŒ–ä¸ºå°çš„æ­£æ€åˆ†å¸ƒ
                if m.bias is not None:
                    nn.init.constant_(m.bias, 0)  # åç½®åˆå§‹åŒ–ä¸º0

    def forward(self, x):
        b, c, h, w = x.shape  # è·å–è¾“å…¥çš„batch size, é€šé“æ•°, é«˜, å®½
        x = x.view(b * self.groups, -1, h, w)  # é‡å¡‘è¾“å…¥
        xn = x * self.avg_pool(x)  # è®¡ç®—å¹³å‡æ± åŒ–åçš„ç»“æœ
        xn = xn.sum(dim=1, keepdim=True)  # å¯¹æ¯ç»„æ±‚å’Œ
        t = xn.view(b * self.groups, -1)  # é‡å¡‘
        t = t - t.mean(dim=1, keepdim=True)  # å‡å»å‡å€¼
        std = t.std(dim=1, keepdim=True) + 1e-5  # è®¡ç®—æ ‡å‡†å·®
        t = t / std  # å½’ä¸€åŒ–
        t = t.view(b, self.groups, h, w)  # é‡å¡‘
        t = t * self.weight + self.bias  # åŠ æƒå’Œåç½®
        t = t.view(b * self.groups, 1, h, w)  # é‡å¡‘
        x = x * self.sig(t)  # åº”ç”¨sigmoidæ¿€æ´»
        x = x.view(b, c, h, w)  # è¿”å›åˆ°åŸå§‹å½¢çŠ¶
        return x
```

ä»¥ä¸Šä»£ç ä¿ç•™äº† `EMA`, `SimAM`, å’Œ `SpatialGroupEnhance` ä¸‰ä¸ªç±»çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œå¹¶è¿›è¡Œäº†è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶ `attention.py` å®ç°äº†ä¸€ç³»åˆ—çš„æ³¨æ„åŠ›æœºåˆ¶æ¨¡å—ï¼Œä¸»è¦ç”¨äºæ·±åº¦å­¦ä¹ ä¸­çš„è§†è§‰ä»»åŠ¡ã€‚ä»¥ä¸‹æ˜¯å¯¹æ–‡ä»¶ä¸­ä¸»è¦éƒ¨åˆ†çš„é€æ­¥è®²è§£ã€‚

é¦–å…ˆï¼Œæ–‡ä»¶å¯¼å…¥äº†å¿…è¦çš„åº“ï¼ŒåŒ…æ‹¬ PyTorchã€Torchvision å’Œä¸€äº›è‡ªå®šä¹‰æ¨¡å—ã€‚æ¥ç€ï¼Œå®šä¹‰äº†ä¸€äº›å…¨å±€å˜é‡å’Œå¸¸é‡ã€‚

æ¥ä¸‹æ¥ï¼Œå®šä¹‰äº†å¤šä¸ªç±»ï¼Œæ¯ä¸ªç±»å®ç°ä¸€ç§ç‰¹å®šçš„æ³¨æ„åŠ›æœºåˆ¶æˆ–æ¨¡å—ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ä¸»è¦ç±»çš„åŠŸèƒ½æ¦‚è¿°ï¼š

1. **EMA (Exponential Moving Average)**ï¼šå®ç°äº†ä¸€ç§åŸºäºæŒ‡æ•°ç§»åŠ¨å¹³å‡çš„æ³¨æ„åŠ›æœºåˆ¶ï¼Œé€šè¿‡å¯¹è¾“å…¥ç‰¹å¾è¿›è¡Œåˆ†ç»„å¤„ç†ï¼Œè®¡ç®—æ¯ä¸ªç»„çš„åŠ æƒå¹³å‡å€¼ï¼Œä»è€Œå¢å¼ºç‰¹å¾çš„è¡¨è¾¾èƒ½åŠ›ã€‚

2. **SimAM (Similarity Attention Module)**ï¼šé€šè¿‡è®¡ç®—è¾“å…¥ç‰¹å¾çš„å‡å€¼å’Œæ–¹å·®ï¼Œç”Ÿæˆä¸€ä¸ªæ³¨æ„åŠ›æƒé‡ï¼Œæ¥å¢å¼ºç‰¹å¾çš„è¡¨ç¤ºèƒ½åŠ›ã€‚

3. **SpatialGroupEnhance**ï¼šå®ç°äº†ä¸€ç§ç©ºé—´ç»„å¢å¼ºæœºåˆ¶ï¼Œé€šè¿‡å¯¹è¾“å…¥ç‰¹å¾è¿›è¡Œå¹³å‡æ± åŒ–ï¼Œè®¡ç®—ç©ºé—´ä¸Šçš„é‡è¦æ€§ï¼Œå¹¶é€šè¿‡åŠ æƒæ¥å¢å¼ºç‰¹å¾ã€‚

4. **TopkRouting**ï¼šå®ç°äº†ä¸€ç§å¯å¾®åˆ†çš„ Top-k è·¯ç”±æœºåˆ¶ï¼Œé€‰æ‹©æœ€é‡è¦çš„ k ä¸ªç‰¹å¾è¿›è¡Œå¤„ç†ï¼Œå¢å¼ºæ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›ã€‚

5. **KVGather**ï¼šç”¨äºæ ¹æ®è·¯ç”±ç´¢å¼•é€‰æ‹©ç‰¹å¾çš„å…³é”®å€¼ï¼ˆkey-valueï¼‰ï¼Œæ”¯æŒä¸åŒçš„åŠ æƒæ–¹å¼ã€‚

6. **QKVLinear**ï¼šå®ç°äº†ä¸€ä¸ªçº¿æ€§å±‚ï¼Œç”¨äºç”ŸæˆæŸ¥è¯¢ï¼ˆqueryï¼‰ã€é”®ï¼ˆkeyï¼‰å’Œå€¼ï¼ˆvalueï¼‰ç‰¹å¾ã€‚

7. **BiLevelRoutingAttention**ï¼šå®ç°äº†ä¸€ç§åŒå±‚è·¯ç”±æ³¨æ„åŠ›æœºåˆ¶ï¼Œç»“åˆäº†å±€éƒ¨å’Œå…¨å±€ç‰¹å¾çš„å¤„ç†ï¼Œå¢å¼ºäº†æ¨¡å‹å¯¹ç‰¹å¾çš„å…³æ³¨èƒ½åŠ›ã€‚

8. **CoordAtt**ã€**TripletAttention**ã€**BAMBlock**ã€**EfficientAttention** ç­‰ç±»å®ç°äº†ä¸åŒç±»å‹çš„æ³¨æ„åŠ›æœºåˆ¶ï¼Œåˆ†åˆ«å…³æ³¨ä¸åŒçš„ç‰¹å¾ç»´åº¦å’Œç©ºé—´ä¿¡æ¯ã€‚

9. **LSKA (Large-Separable-Kernel-Attention)** å’Œ **SegNext_Attention** ç­‰ç±»å®ç°äº†åŸºäºå¤§åˆ†ç¦»å·ç§¯çš„æ³¨æ„åŠ›æœºåˆ¶ï¼Œå¢å¼ºäº†ç‰¹å¾æå–çš„èƒ½åŠ›ã€‚

10. **EffectiveSEModule**ã€**CPCA**ã€**MPCA** ç­‰ç±»å®ç°äº†ä¸åŒçš„é€šé“æ³¨æ„åŠ›æœºåˆ¶ï¼Œæ—¨åœ¨å¢å¼ºç‰¹å¾é€šé“çš„è¡¨è¾¾èƒ½åŠ›ã€‚

11. **DAttention** å’Œ **FocusedLinearAttention** ç­‰ç±»å®ç°äº†åŸºäºå˜å½¢å·ç§¯å’Œçº¿æ€§æ³¨æ„åŠ›çš„æœºåˆ¶ï¼Œæ—¨åœ¨æé«˜æ¨¡å‹å¯¹ç‰¹å¾çš„å…³æ³¨å’Œå¤„ç†èƒ½åŠ›ã€‚

æ¯ä¸ªç±»çš„ `forward` æ–¹æ³•å®šä¹‰äº†å‰å‘ä¼ æ’­çš„é€»è¾‘ï¼Œå¤„ç†è¾“å…¥ç‰¹å¾å¹¶ç”Ÿæˆè¾“å‡ºç‰¹å¾ã€‚é€šè¿‡è¿™äº›æ³¨æ„åŠ›æœºåˆ¶ï¼Œæ¨¡å‹èƒ½å¤Ÿæ›´å¥½åœ°å…³æ³¨é‡è¦çš„ç‰¹å¾ï¼Œæé«˜è§†è§‰ä»»åŠ¡çš„æ€§èƒ½ã€‚

æ€»çš„æ¥è¯´ï¼Œè¿™ä¸ªæ–‡ä»¶æä¾›äº†ä¸€ç³»åˆ—çµæ´»ä¸”é«˜æ•ˆçš„æ³¨æ„åŠ›æœºåˆ¶æ¨¡å—ï¼Œé€‚ç”¨äºå„ç§è§†è§‰ä»»åŠ¡ï¼Œèƒ½å¤Ÿå¸®åŠ©æ¨¡å‹æ›´å¥½åœ°ç†è§£å’Œå¤„ç†è¾“å…¥æ•°æ®ã€‚

æ³¨æ„ï¼šç”±äºæ­¤åšå®¢ç¼–è¾‘è¾ƒæ—©ï¼Œä¸Šé¢â€œ10.YOLOv11æ ¸å¿ƒæ”¹è¿›æºç è®²è§£â€ä¸­éƒ¨åˆ†ä»£ç å¯èƒ½ä¼šä¼˜åŒ–å‡çº§ï¼Œä»…ä¾›å‚è€ƒå­¦ä¹ ï¼Œä»¥â€œ11.å®Œæ•´è®­ç»ƒ+Webå‰ç«¯ç•Œé¢+200+ç§å…¨å¥—åˆ›æ–°ç‚¹æºç ã€æ•°æ®é›†è·å–â€çš„å†…å®¹ä¸ºå‡†ã€‚

### 11.å®Œæ•´è®­ç»ƒ+Webå‰ç«¯ç•Œé¢+200+ç§å…¨å¥—åˆ›æ–°ç‚¹æºç ã€æ•°æ®é›†è·å–

![19.png](19.png)


# [ä¸‹è½½é“¾æ¥ï¼šhttps://mbd.pub/o/bread/Zp6Xl5xw](https://mbd.pub/o/bread/Zp6Xl5xw)